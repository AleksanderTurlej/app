1624677504
waR3U4bTeM%3A242f496035cce89630eb7c9616e95f42-724c043a883314532ba0a45af693dfb1
s:133280:"TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlIjoxMjp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBkb2NCbG9jayI7TjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGhhc2giO3M6MzI6IjcyNGMwNDNhODgzMzE0NTMyYmEwYTQ1YWY2OTNkZmIxIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWUiO3M6Njg6ImFhOGRhOWVhNmU5MmI5ZDBlNGYwNGJmYTkyZTQ1YWE1M2Y1MzYwZDVhOTgxYTllZjdhM2Y5NTEyOGI2OWE2MGMucGhwIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHBhdGgiO3M6OTA6InZhci9jYWNoZS9kZXYvdHdpZy9hYS9hYThkYTllYTZlOTJiOWQwZTRmMDRiZmE5MmU0NWFhNTNmNTM2MGQ1YTk4MWE5ZWY3YTNmOTUxMjhiNjlhNjBjLnBocCI7czo0MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBzb3VyY2UiO3M6ODU5MDA6Ijw/cGhwCgp1c2UgVHdpZ1xFbnZpcm9ubWVudDsKdXNlIFR3aWdcRXJyb3JcTG9hZGVyRXJyb3I7CnVzZSBUd2lnXEVycm9yXFJ1bnRpbWVFcnJvcjsKdXNlIFR3aWdcRXh0ZW5zaW9uXFNhbmRib3hFeHRlbnNpb247CnVzZSBUd2lnXE1hcmt1cDsKdXNlIFR3aWdcU2FuZGJveFxTZWN1cml0eUVycm9yOwp1c2UgVHdpZ1xTYW5kYm94XFNlY3VyaXR5Tm90QWxsb3dlZFRhZ0Vycm9yOwp1c2UgVHdpZ1xTYW5kYm94XFNlY3VyaXR5Tm90QWxsb3dlZEZpbHRlckVycm9yOwp1c2UgVHdpZ1xTYW5kYm94XFNlY3VyaXR5Tm90QWxsb3dlZEZ1bmN0aW9uRXJyb3I7CnVzZSBUd2lnXFNvdXJjZTsKdXNlIFR3aWdcVGVtcGxhdGU7CgovKiBAV2ViUHJvZmlsZXIvUHJvZmlsZXIvYmFzZV9qcy5odG1sLnR3aWcgKi8KY2xhc3MgX19Ud2lnVGVtcGxhdGVfMjlhMGE2MjU3MmYwYzJlZTRkNDMzZWQyYWM4Njg4NGIwYjdlODczNTJhOTM2ZTgyZTg5ODlkNzg0NzczN2M0NSBleHRlbmRzIFRlbXBsYXRlCnsKICAgIHByaXZhdGUgJHNvdXJjZTsKICAgIHByaXZhdGUgJG1hY3JvcyA9IFtdOwoKICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdChFbnZpcm9ubWVudCAkZW52KQogICAgewogICAgICAgIHBhcmVudDo6X19jb25zdHJ1Y3QoJGVudik7CgogICAgICAgICR0aGlzLT5zb3VyY2UgPSAkdGhpcy0+Z2V0U291cmNlQ29udGV4dCgpOwoKICAgICAgICAkdGhpcy0+cGFyZW50ID0gZmFsc2U7CgogICAgICAgICR0aGlzLT5ibG9ja3MgPSBbCiAgICAgICAgXTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZG9EaXNwbGF5KGFycmF5ICRjb250ZXh0LCBhcnJheSAkYmxvY2tzID0gW10pCiAgICB7CiAgICAgICAgJG1hY3JvcyA9ICR0aGlzLT5tYWNyb3M7CiAgICAgICAgJF9faW50ZXJuYWxfMDg1YjAxNDI4MDYyMDI1OTljN2ZlM2IzMjkxNjRhOTIzOTdkODk3ODIwN2EzN2U3OWQ3MGI4YzUyNTk5ZTMzZSA9ICR0aGlzLT5leHRlbnNpb25zWyJTeW1mb255XFxCdW5kbGVcXFdlYlByb2ZpbGVyQnVuZGxlXFxUd2lnXFxXZWJQcm9maWxlckV4dGVuc2lvbiJdOwogICAgICAgICRfX2ludGVybmFsXzA4NWIwMTQyODA2MjAyNTk5YzdmZTNiMzI5MTY0YTkyMzk3ZDg5NzgyMDdhMzdlNzlkNzBiOGM1MjU5OWUzM2UtPmVudGVyKCRfX2ludGVybmFsXzA4NWIwMTQyODA2MjAyNTk5YzdmZTNiMzI5MTY0YTkyMzk3ZDg5NzgyMDdhMzdlNzlkNzBiOGM1MjU5OWUzM2VfcHJvZiA9IG5ldyBcVHdpZ1xQcm9maWxlclxQcm9maWxlKCR0aGlzLT5nZXRUZW1wbGF0ZU5hbWUoKSwgInRlbXBsYXRlIiwgIkBXZWJQcm9maWxlci9Qcm9maWxlci9iYXNlX2pzLmh0bWwudHdpZyIpKTsKCiAgICAgICAgJF9faW50ZXJuYWxfMzE5MzkzNDYxMzA5ODkyOTI0ZmY2ZTc0ZDZkNmU2NDI4N2RmNjRiNjM1NDViOTk0ZTEwMGQ0YWIyMjNhZWQwMiA9ICR0aGlzLT5leHRlbnNpb25zWyJTeW1mb255XFxCcmlkZ2VcXFR3aWdcXEV4dGVuc2lvblxcUHJvZmlsZXJFeHRlbnNpb24iXTsKICAgICAgICAkX19pbnRlcm5hbF8zMTkzOTM0NjEzMDk4OTI5MjRmZjZlNzRkNmQ2ZTY0Mjg3ZGY2NGI2MzU0NWI5OTRlMTAwZDRhYjIyM2FlZDAyLT5lbnRlcigkX19pbnRlcm5hbF8zMTkzOTM0NjEzMDk4OTI5MjRmZjZlNzRkNmQ2ZTY0Mjg3ZGY2NGI2MzU0NWI5OTRlMTAwZDRhYjIyM2FlZDAyX3Byb2YgPSBuZXcgXFR3aWdcUHJvZmlsZXJcUHJvZmlsZSgkdGhpcy0+Z2V0VGVtcGxhdGVOYW1lKCksICJ0ZW1wbGF0ZSIsICJAV2ViUHJvZmlsZXIvUHJvZmlsZXIvYmFzZV9qcy5odG1sLnR3aWciKSk7CgogICAgICAgIC8vIGxpbmUgMwogICAgICAgIGVjaG8gIjxzY3JpcHQiOwogICAgICAgIGlmICgoKGlzc2V0KCRjb250ZXh0WyJjc3Bfc2NyaXB0X25vbmNlIl0pIHx8IGFycmF5X2tleV9leGlzdHMoImNzcF9zY3JpcHRfbm9uY2UiLCAkY29udGV4dCkpICYmIChpc3NldCgkY29udGV4dFsiY3NwX3NjcmlwdF9ub25jZSJdKSB8fCBhcnJheV9rZXlfZXhpc3RzKCJjc3Bfc2NyaXB0X25vbmNlIiwgJGNvbnRleHQpID8gJGNvbnRleHRbImNzcF9zY3JpcHRfbm9uY2UiXSA6IChmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBSdW50aW1lRXJyb3IoJ1ZhcmlhYmxlICJjc3Bfc2NyaXB0X25vbmNlIiBkb2VzIG5vdCBleGlzdC4nLCAzLCAkdGhpcy0+c291cmNlKTsgfSkoKSkpKSB7CiAgICAgICAgICAgIGVjaG8gIiBub25jZT1cIiI7CiAgICAgICAgICAgIGVjaG8gdHdpZ19lc2NhcGVfZmlsdGVyKCR0aGlzLT5lbnYsIChpc3NldCgkY29udGV4dFsiY3NwX3NjcmlwdF9ub25jZSJdKSB8fCBhcnJheV9rZXlfZXhpc3RzKCJjc3Bfc2NyaXB0X25vbmNlIiwgJGNvbnRleHQpID8gJGNvbnRleHRbImNzcF9zY3JpcHRfbm9uY2UiXSA6IChmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBSdW50aW1lRXJyb3IoJ1ZhcmlhYmxlICJjc3Bfc2NyaXB0X25vbmNlIiBkb2VzIG5vdCBleGlzdC4nLCAzLCAkdGhpcy0+c291cmNlKTsgfSkoKSksICJodG1sIiwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgIGVjaG8gIlwiIjsKICAgICAgICB9CiAgICAgICAgZWNobyAiPi8qPCFbQ0RBVEFbKi8KICAgICI7CiAgICAgICAgLy8gbGluZSA3CiAgICAgICAgZWNobyAiCiAgICBTZmpzID0gKGZ1bmN0aW9uKCkgewogICAgICAgIFwidXNlIHN0cmljdFwiOwoKICAgICAgICBpZiAoJ2NsYXNzTGlzdCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgICAgICAgIHZhciBoYXNDbGFzcyA9IGZ1bmN0aW9uIChlbCwgY3NzQ2xhc3MpIHsgcmV0dXJuIGVsLmNsYXNzTGlzdC5jb250YWlucyhjc3NDbGFzcyk7IH07CiAgICAgICAgICAgIHZhciByZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBlbC5jbGFzc0xpc3QucmVtb3ZlKGNzc0NsYXNzKTsgfTsKICAgICAgICAgICAgdmFyIGFkZENsYXNzID0gZnVuY3Rpb24oZWwsIGNzc0NsYXNzKSB7IGVsLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3MpOyB9OwogICAgICAgICAgICB2YXIgdG9nZ2xlQ2xhc3MgPSBmdW5jdGlvbihlbCwgY3NzQ2xhc3MpIHsgZWwuY2xhc3NMaXN0LnRvZ2dsZShjc3NDbGFzcyk7IH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGhhc0NsYXNzID0gZnVuY3Rpb24gKGVsLCBjc3NDbGFzcykgeyByZXR1cm4gZWwuY2xhc3NOYW1lLm1hdGNoKG5ldyBSZWdFeHAoJ1xcXFxiJyArIGNzc0NsYXNzICsgJ1xcXFxiJykpOyB9OwogICAgICAgICAgICB2YXIgcmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbihlbCwgY3NzQ2xhc3MpIHsgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lLnJlcGxhY2UobmV3IFJlZ0V4cCgnXFxcXGInICsgY3NzQ2xhc3MgKyAnXFxcXGInKSwgJyAnKTsgfTsKICAgICAgICAgICAgdmFyIGFkZENsYXNzID0gZnVuY3Rpb24oZWwsIGNzc0NsYXNzKSB7IGlmICghaGFzQ2xhc3MoZWwsIGNzc0NsYXNzKSkgeyBlbC5jbGFzc05hbWUgKz0gXCIgXCIgKyBjc3NDbGFzczsgfSB9OwogICAgICAgICAgICB2YXIgdG9nZ2xlQ2xhc3MgPSBmdW5jdGlvbihlbCwgY3NzQ2xhc3MpIHsgaGFzQ2xhc3MoZWwsIGNzc0NsYXNzKSA/IHJlbW92ZUNsYXNzKGVsLCBjc3NDbGFzcykgOiBhZGRDbGFzcyhlbCwgY3NzQ2xhc3MpOyB9OwogICAgICAgIH0KCiAgICAgICAgdmFyIG5vb3AgPSBmdW5jdGlvbigpIHt9OwoKICAgICAgICB2YXIgcHJvZmlsZXJTdG9yYWdlS2V5ID0gJ3N5bWZvbnkvcHJvZmlsZXIvJzsKCiAgICAgICAgdmFyIGFkZEV2ZW50TGlzdGVuZXI7CgogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGlmICghKCdhZGRFdmVudExpc3RlbmVyJyBpbiBlbCkpIHsKICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIChlbGVtZW50LCBldmVudE5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dGFjaEV2ZW50KCdvbicgKyBldmVudE5hbWUsIGNhbGxiYWNrKTsKICAgICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50TmFtZSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGNhbGxiYWNrLCBmYWxzZSk7CiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVxdWVzdCA9IGZ1bmN0aW9uKHVybCwgb25TdWNjZXNzLCBvbkVycm9yLCBwYXlsb2FkLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciB4aHIgPSB3aW5kb3cuWE1MSHR0cFJlcXVlc3QgPyBuZXcgWE1MSHR0cFJlcXVlc3QoKSA6IG5ldyBBY3RpdmVYT2JqZWN0KCdNaWNyb3NvZnQuWE1MSFRUUCcpOwogICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgICAgb3B0aW9ucy5tYXhUcmllcyA9IG9wdGlvbnMubWF4VHJpZXMgfHwgMDsKICAgICAgICAgICAgeGhyLm9wZW4ob3B0aW9ucy5tZXRob2QgfHwgJ0dFVCcsIHVybCwgdHJ1ZSk7CiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLVJlcXVlc3RlZC1XaXRoJywgJ1hNTEh0dHBSZXF1ZXN0Jyk7CiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbihzdGF0ZSkgewogICAgICAgICAgICAgICAgaWYgKDQgIT09IHhoci5yZWFkeVN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT0gNDA0ICYmIG9wdGlvbnMubWF4VHJpZXMgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1heFRyaWVzLS07CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QodXJsLCBvblN1Y2Nlc3MsIG9uRXJyb3IsIHBheWxvYWQsIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoMjAwID09PSB4aHIuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgKG9uU3VjY2VzcyB8fCBub29wKSh4aHIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAob25FcnJvciB8fCBub29wKSh4aHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB4aHIuc2VuZChwYXlsb2FkIHx8ICcnKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgZ2V0UHJlZmVyZW5jZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb2ZpbGVyU3RvcmFnZUtleSArIG5hbWUpOwogICAgICAgIH07CgogICAgICAgIHZhciBzZXRQcmVmZXJlbmNlID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJvZmlsZXJTdG9yYWdlS2V5ICsgbmFtZSwgdmFsdWUpOwogICAgICAgIH07CgogICAgICAgIHZhciByZXF1ZXN0U3RhY2sgPSBbXTsKCiAgICAgICAgdmFyIGV4dHJhY3RIZWFkZXJzID0gZnVuY3Rpb24oeGhyLCBzdGFja0VsZW1lbnQpIHsKICAgICAgICAgICAgLyogSGVyZSB3ZSBhdm9pZCB0byBjYWxsIHhoci5nZXRSZXNwb25zZUhlYWRlciBpbiBvcmRlciB0byAqLwogICAgICAgICAgICAvKiBwcmV2ZW50IHBvbGx1dGluZyB0aGUgY29uc29sZSB3aXRoIENPUlMgc2VjdXJpdHkgZXJyb3JzICovCiAgICAgICAgICAgIHZhciBhbGxIZWFkZXJzID0geGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpOwogICAgICAgICAgICB2YXIgcmV0OwoKICAgICAgICAgICAgaWYgKHJldCA9IGFsbEhlYWRlcnMubWF0Y2goL154LWRlYnVnLXRva2VuOlxccysoLiopXCQvaW0pKSB7CiAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQucHJvZmlsZSA9IHJldFsxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmV0ID0gYWxsSGVhZGVycy5tYXRjaCgvXngtZGVidWctdG9rZW4tbGluazpcXHMrKC4qKVwkL2ltKSkgewogICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnByb2ZpbGVyVXJsID0gcmV0WzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXQgPSBhbGxIZWFkZXJzLm1hdGNoKC9eU3ltZm9ueS1EZWJ1Zy1Ub29sYmFyLVJlcGxhY2U6XFxzKyguKilcJC9pbSkpIHsKICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC50b29sYmFyUmVwbGFjZUZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQudG9vbGJhclJlcGxhY2UgPSAnMScgPT09IHJldFsxXTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBzdWNjZXNzU3RyZWFrID0gNDsKICAgICAgICB2YXIgcGVuZGluZ1JlcXVlc3RzID0gMDsKICAgICAgICB2YXIgcmVuZGVyQWpheFJlcXVlc3RzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0Q291bnRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWFqYXgtcmVxdWVzdC1jb3VudGVyJyk7CiAgICAgICAgICAgIGlmICghcmVxdWVzdENvdW50ZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXF1ZXN0Q291bnRlci50ZXh0Q29udGVudCA9IHJlcXVlc3RTdGFjay5sZW5ndGg7CgogICAgICAgICAgICB2YXIgaW5mb1NwYW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNmLXRvb2xiYXItYWpheC1pbmZvXCIpOwogICAgICAgICAgICBpZiAoaW5mb1NwYW4pIHsKICAgICAgICAgICAgICAgIGluZm9TcGFuLnRleHRDb250ZW50ID0gcmVxdWVzdFN0YWNrLmxlbmd0aCArICcgQUpBWCByZXF1ZXN0JyArIChyZXF1ZXN0U3RhY2subGVuZ3RoICE9PSAxID8gJ3MnIDogJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWpheFRvb2xiYXJQYW5lbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWJsb2NrLWFqYXgnKTsKICAgICAgICAgICAgaWYgKHJlcXVlc3RTdGFjay5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGFqYXhUb29sYmFyUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhamF4VG9vbGJhclBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBlbmRpbmdSZXF1ZXN0cyA+IDApIHsKICAgICAgICAgICAgICAgIGFkZENsYXNzKGFqYXhUb29sYmFyUGFuZWwsICdzZi1hamF4LXJlcXVlc3QtbG9hZGluZycpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN1Y2Nlc3NTdHJlYWsgPCA0KSB7CiAgICAgICAgICAgICAgICBhZGRDbGFzcyhhamF4VG9vbGJhclBhbmVsLCAnc2YtdG9vbGJhci1zdGF0dXMtcmVkJyk7CiAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhhamF4VG9vbGJhclBhbmVsLCAnc2YtYWpheC1yZXF1ZXN0LWxvYWRpbmcnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGFqYXhUb29sYmFyUGFuZWwsICdzZi1hamF4LXJlcXVlc3QtbG9hZGluZycpOwogICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoYWpheFRvb2xiYXJQYW5lbCwgJ3NmLXRvb2xiYXItc3RhdHVzLXJlZCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWFqYXgtY2xlYXInKSwgJ2NsaWNrJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0U3RhY2sgPSBbXTsKICAgICAgICAgICAgICAgIHJlbmRlckFqYXhSZXF1ZXN0cygpOwogICAgICAgICAgICAgICAgc3VjY2Vzc1N0cmVhayA9IDQ7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1hamF4LXJlcXVlc3QtbGlzdCcpLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICB2YXIgc3RhcnRBamF4UmVxdWVzdCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgICAgIHZhciB0Ym9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWFqYXgtcmVxdWVzdC1saXN0Jyk7CiAgICAgICAgICAgIGlmICghdGJvZHkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG5iT2ZBamF4UmVxdWVzdCA9IHRib2R5LnJvd3MubGVuZ3RoOwogICAgICAgICAgICBpZiAobmJPZkFqYXhSZXF1ZXN0ID49IDEwMCkgewogICAgICAgICAgICAgICAgdGJvZHkuZGVsZXRlUm93KDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHJlcXVlc3RTdGFja1tpbmRleF07CiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0cysrOwogICAgICAgICAgICB2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgcmVxdWVzdC5ET01Ob2RlID0gcm93OwoKICAgICAgICAgICAgdmFyIHJlcXVlc3ROdW1iZXJDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgcmVxdWVzdE51bWJlckNlbGwudGV4dENvbnRlbnQgPSBpbmRleCArIDE7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChyZXF1ZXN0TnVtYmVyQ2VsbCk7CgogICAgICAgICAgICB2YXIgcHJvZmlsZXJDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgcHJvZmlsZXJDZWxsLnRleHRDb250ZW50ID0gJ24vYSc7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChwcm9maWxlckNlbGwpOwoKICAgICAgICAgICAgdmFyIG1ldGhvZENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICBtZXRob2RDZWxsLnRleHRDb250ZW50ID0gcmVxdWVzdC5tZXRob2Q7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChtZXRob2RDZWxsKTsKCiAgICAgICAgICAgIHZhciB0eXBlQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgIHR5cGVDZWxsLnRleHRDb250ZW50ID0gcmVxdWVzdC50eXBlOwogICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQodHlwZUNlbGwpOwoKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGVDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgIHN0YXR1c0NvZGUudGV4dENvbnRlbnQgPSAnbi9hJzsKICAgICAgICAgICAgc3RhdHVzQ29kZUNlbGwuYXBwZW5kQ2hpbGQoc3RhdHVzQ29kZSk7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChzdGF0dXNDb2RlQ2VsbCk7CgogICAgICAgICAgICB2YXIgcGF0aENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICBwYXRoQ2VsbC5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0LXVybCc7CiAgICAgICAgICAgIGlmICgnR0VUJyA9PT0gcmVxdWVzdC5tZXRob2QpIHsKICAgICAgICAgICAgICAgIHZhciBwYXRoTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgICAgIHBhdGhMaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIHJlcXVlc3QudXJsKTsKICAgICAgICAgICAgICAgIHBhdGhMaW5rLnRleHRDb250ZW50ID0gcmVxdWVzdC51cmw7CiAgICAgICAgICAgICAgICBwYXRoQ2VsbC5hcHBlbmRDaGlsZChwYXRoTGluayk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXRoQ2VsbC50ZXh0Q29udGVudCA9IHJlcXVlc3QudXJsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhdGhDZWxsLnNldEF0dHJpYnV0ZSgndGl0bGUnLCByZXF1ZXN0LnVybCk7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChwYXRoQ2VsbCk7CgogICAgICAgICAgICB2YXIgZHVyYXRpb25DZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgZHVyYXRpb25DZWxsLmNsYXNzTmFtZSA9ICdzZi1hamF4LXJlcXVlc3QtZHVyYXRpb24nOwogICAgICAgICAgICBkdXJhdGlvbkNlbGwudGV4dENvbnRlbnQgPSAnbi9hJzsKICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKGR1cmF0aW9uQ2VsbCk7CgogICAgICAgICAgICByZXF1ZXN0LmxpdmVEdXJhdGlvbkhhbmRsZSA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZHVyYXRpb25DZWxsLnRleHRDb250ZW50ID0gKG5ldyBEYXRlKCkgLSByZXF1ZXN0LnN0YXJ0KSArICdtcyc7CiAgICAgICAgICAgIH0sIDEwMCk7CgogICAgICAgICAgICByb3cuY2xhc3NOYW1lID0gJ3NmLWFqYXgtcmVxdWVzdCBzZi1hamF4LXJlcXVlc3QtbG9hZGluZyc7CiAgICAgICAgICAgIHRib2R5Lmluc2VydEJlZm9yZShyb3csIG51bGwpOwoKICAgICAgICAgICAgdmFyIHRvb2xiYXJJbmZvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stYWpheCAuc2YtdG9vbGJhci1pbmZvJyk7CiAgICAgICAgICAgIHRvb2xiYXJJbmZvLnNjcm9sbFRvcCA9IHRvb2xiYXJJbmZvLnNjcm9sbEhlaWdodDsKCiAgICAgICAgICAgIHJlbmRlckFqYXhSZXF1ZXN0cygpOwogICAgICAgIH07CgogICAgICAgIHZhciBmaW5pc2hBamF4UmVxdWVzdCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gcmVxdWVzdFN0YWNrW2luZGV4XTsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChyZXF1ZXN0LmxpdmVEdXJhdGlvbkhhbmRsZSk7CgogICAgICAgICAgICBpZiAoIXJlcXVlc3QuRE9NTm9kZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdC50b29sYmFyUmVwbGFjZSAmJiAhcmVxdWVzdC50b29sYmFyUmVwbGFjZUZpbmlzaGVkICYmIHJlcXVlc3QucHJvZmlsZSkgewogICAgICAgICAgICAgICAgLyogRmxhZyBhcyBjb21wbGV0ZSBiZWNhdXNlIGZpbmlzaEFqYXhSZXF1ZXN0IGNhbiBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMuICovCiAgICAgICAgICAgICAgICByZXF1ZXN0LnRvb2xiYXJSZXBsYWNlRmluaXNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgLyogU2VhcmNoIHVwIHRocm91Z2ggdGhlIERPTSB0byBmaW5kIHRoZSB0b29sYmFyJ3MgY29udGFpbmVyIElELiAqLwogICAgICAgICAgICAgICAgZm9yICh2YXIgZWxlbSA9IHJlcXVlc3QuRE9NTm9kZTsgZWxlbSAmJiBlbGVtICE9PSBkb2N1bWVudDsgZWxlbSA9IGVsZW0ucGFyZW50Tm9kZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtLmlkLm1hdGNoKC9ec2Z3ZHQvKSkgewogICAgICAgICAgICAgICAgICAgICAgICBTZmpzLmxvYWRUb29sYmFyKGVsZW0uaWQucmVwbGFjZSgvXnNmd2R0LywgJycpLCByZXF1ZXN0LnByb2ZpbGUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0cy0tOwogICAgICAgICAgICB2YXIgcm93ID0gcmVxdWVzdC5ET01Ob2RlOwogICAgICAgICAgICAvKiBVbnBhY2sgdGhlIGNoaWxkcmVuIGZyb20gdGhlIHJvdyAqLwogICAgICAgICAgICB2YXIgcHJvZmlsZXJDZWxsID0gcm93LmNoaWxkcmVuWzFdOwogICAgICAgICAgICB2YXIgbWV0aG9kQ2VsbCA9IHJvdy5jaGlsZHJlblsyXTsKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGVDZWxsID0gcm93LmNoaWxkcmVuWzRdOwogICAgICAgICAgICB2YXIgc3RhdHVzQ29kZUVsZW0gPSBzdGF0dXNDb2RlQ2VsbC5jaGlsZHJlblswXTsKICAgICAgICAgICAgdmFyIGR1cmF0aW9uQ2VsbCA9IHJvdy5jaGlsZHJlbls2XTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LmVycm9yKSB7CiAgICAgICAgICAgICAgICByb3cuY2xhc3NOYW1lID0gJ3NmLWFqYXgtcmVxdWVzdCBzZi1hamF4LXJlcXVlc3QtZXJyb3InOwogICAgICAgICAgICAgICAgbWV0aG9kQ2VsbC5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0LWVycm9yJzsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NTdHJlYWsgPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcm93LmNsYXNzTmFtZSA9ICdzZi1hamF4LXJlcXVlc3Qgc2YtYWpheC1yZXF1ZXN0LW9rJzsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NTdHJlYWsrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzQ29kZSkgewogICAgICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzQ29kZSA8IDMwMCkgewogICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGVFbGVtLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc2YtdG9vbGJhci1zdGF0dXMnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxdWVzdC5zdGF0dXNDb2RlIDwgNDAwKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZUVsZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsICdzZi10b29sYmFyLXN0YXR1cyBzZi10b29sYmFyLXN0YXR1cy15ZWxsb3cnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZUVsZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsICdzZi10b29sYmFyLXN0YXR1cyBzZi10b29sYmFyLXN0YXR1cy1yZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXR1c0NvZGVFbGVtLnRleHRDb250ZW50ID0gcmVxdWVzdC5zdGF0dXNDb2RlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RhdHVzQ29kZUVsZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsICdzZi10b29sYmFyLXN0YXR1cyBzZi10b29sYmFyLXN0YXR1cy1yZWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlcXVlc3QuZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgIGR1cmF0aW9uQ2VsbC50ZXh0Q29udGVudCA9IHJlcXVlc3QuZHVyYXRpb24gKyAnbXMnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdC5wcm9maWxlclVybCkgewogICAgICAgICAgICAgICAgcHJvZmlsZXJDZWxsLnRleHRDb250ZW50ID0gJyc7CiAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZXJMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICAgICAgcHJvZmlsZXJMaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIHJlcXVlc3QucHJvZmlsZXJVcmwpOwogICAgICAgICAgICAgICAgcHJvZmlsZXJMaW5rLnRleHRDb250ZW50ID0gcmVxdWVzdC5wcm9maWxlOwogICAgICAgICAgICAgICAgcHJvZmlsZXJDZWxsLmFwcGVuZENoaWxkKHByb2ZpbGVyTGluayk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlbmRlckFqYXhSZXF1ZXN0cygpOwogICAgICAgIH07CgogICAgICAgICI7CiAgICAgICAgLy8gbGluZSAyNzgKICAgICAgICBpZiAoKGlzc2V0KCRjb250ZXh0WyJleGNsdWRlZF9hamF4X3BhdGhzIl0pIHx8IGFycmF5X2tleV9leGlzdHMoImV4Y2x1ZGVkX2FqYXhfcGF0aHMiLCAkY29udGV4dCkpKSB7CiAgICAgICAgICAgIC8vIGxpbmUgMjc5CiAgICAgICAgICAgIGVjaG8gIiAgICAgICAgICAgIGlmICh3aW5kb3cuZmV0Y2ggJiYgd2luZG93LmZldGNoLnBvbHlmaWxsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBvbGRGZXRjaCA9IHdpbmRvdy5mZXRjaDsKICAgICAgICAgICAgICAgIHdpbmRvdy5mZXRjaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG9sZEZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IGFyZ3VtZW50c1swXTsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gYXJndW1lbnRzWzFdOwogICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbVR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJndW1lbnRzWzBdKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1UeXBlID09PSAnW29iamVjdCBSZXF1ZXN0XScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gYXJndW1lbnRzWzBdLnVybDsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBhcmd1bWVudHNbMF0ubWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6IGFyZ3VtZW50c1swXS5jcmVkZW50aWFscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGFyZ3VtZW50c1swXS5oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogYXJndW1lbnRzWzBdLm1vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDogYXJndW1lbnRzWzBdLnJlZGlyZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gU3RyaW5nKHVybCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghdXJsLm1hdGNoKG5ldyBSZWdFeHAoIjsKICAgICAgICAgICAgLy8gbGluZSAyOTgKICAgICAgICAgICAgZWNobyBqc29uX2VuY29kZSgoaXNzZXQoJGNvbnRleHRbImV4Y2x1ZGVkX2FqYXhfcGF0aHMiXSkgfHwgYXJyYXlfa2V5X2V4aXN0cygiZXhjbHVkZWRfYWpheF9wYXRocyIsICRjb250ZXh0KSA/ICRjb250ZXh0WyJleGNsdWRlZF9hamF4X3BhdGhzIl0gOiAoZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgUnVudGltZUVycm9yKCdWYXJpYWJsZSAiZXhjbHVkZWRfYWpheF9wYXRocyIgZG9lcyBub3QgZXhpc3QuJywgMjk4LCAkdGhpcy0+c291cmNlKTsgfSkoKSkpOwogICAgICAgICAgICBlY2hvICIpKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gJ0dFVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMgJiYgcGFyYW1zLm1ldGhvZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSBwYXJhbXMubWV0aG9kOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhY2tFbGVtZW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmZXRjaCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogbmV3IERhdGUoKQogICAgICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHJlcXVlc3RTdGFjay5wdXNoKHN0YWNrRWxlbWVudCkgLSAxOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5kdXJhdGlvbiA9IG5ldyBEYXRlKCkgLSBzdGFja0VsZW1lbnQuc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuZXJyb3IgPSByLnN0YXR1cyA8IDIwMCB8fCByLnN0YXR1cyA+PSA0MDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuc3RhdHVzQ29kZSA9IHIuc3RhdHVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnByb2ZpbGUgPSByLmhlYWRlcnMuZ2V0KCd4LWRlYnVnLXRva2VuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQucHJvZmlsZXJVcmwgPSByLmhlYWRlcnMuZ2V0KCd4LWRlYnVnLXRva2VuLWxpbmsnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC50b29sYmFyUmVwbGFjZUZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQudG9vbGJhclJlcGxhY2UgPSAnMScgPT09IHIuaGVhZGVycy5nZXQoJ1N5bWZvbnktRGVidWctVG9vbGJhci1SZXBsYWNlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2hBamF4UmVxdWVzdChpZHgpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0QWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0ICYmIFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJveGllZCA9IFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuOwoKICAgICAgICAgICAgICAgIFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24obWV0aG9kLCB1cmwsIGFzeW5jLCB1c2VyLCBwYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgICAgICAgICAvKiBwcmV2ZW50IGxvZ2dpbmcgQUpBWCBjYWxscyB0byBzdGF0aWMgYW5kIGlubGluZSBmaWxlcywgbGlrZSB0ZW1wbGF0ZXMgKi8KICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IHVybDsKICAgICAgICAgICAgICAgICAgICBpZiAodXJsLnN1YnN0cigwLCAxKSA9PT0gJy8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID09PSB1cmwuaW5kZXhPZignIjsKICAgICAgICAgICAgLy8gbGluZSAzNDEKICAgICAgICAgICAgZWNobyB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgdHdpZ19lc2NhcGVfZmlsdGVyKCR0aGlzLT5lbnYsIHR3aWdfZ2V0X2F0dHJpYnV0ZSgkdGhpcy0+ZW52LCAkdGhpcy0+c291cmNlLCAoaXNzZXQoJGNvbnRleHRbInJlcXVlc3QiXSkgfHwgYXJyYXlfa2V5X2V4aXN0cygicmVxdWVzdCIsICRjb250ZXh0KSA/ICRjb250ZXh0WyJyZXF1ZXN0Il0gOiAoZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgUnVudGltZUVycm9yKCdWYXJpYWJsZSAicmVxdWVzdCIgZG9lcyBub3QgZXhpc3QuJywgMzQxLCAkdGhpcy0+c291cmNlKTsgfSkoKSksICJiYXNlUGF0aCIsIFtdLCAiYW55IiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMzQxKSwgImpzIiksICJodG1sIiwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgIGVjaG8gIicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gdXJsLnN1YnN0cigiOwogICAgICAgICAgICAvLyBsaW5lIDM0MgogICAgICAgICAgICBlY2hvIHR3aWdfZXNjYXBlX2ZpbHRlcigkdGhpcy0+ZW52LCB0d2lnX2xlbmd0aF9maWx0ZXIoJHRoaXMtPmVudiwgdHdpZ19nZXRfYXR0cmlidXRlKCR0aGlzLT5lbnYsICR0aGlzLT5zb3VyY2UsIChpc3NldCgkY29udGV4dFsicmVxdWVzdCJdKSB8fCBhcnJheV9rZXlfZXhpc3RzKCJyZXF1ZXN0IiwgJGNvbnRleHQpID8gJGNvbnRleHRbInJlcXVlc3QiXSA6IChmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBSdW50aW1lRXJyb3IoJ1ZhcmlhYmxlICJyZXF1ZXN0IiBkb2VzIG5vdCBleGlzdC4nLCAzNDIsICR0aGlzLT5zb3VyY2UpOyB9KSgpKSwgImJhc2VQYXRoIiwgW10sICJhbnkiLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAzNDIpKSwgImh0bWwiLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgZWNobyAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgwID09PSB1cmwuaW5kZXhPZignIjsKICAgICAgICAgICAgLy8gbGluZSAzNDUKICAgICAgICAgICAgZWNobyB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgdHdpZ19lc2NhcGVfZmlsdGVyKCR0aGlzLT5lbnYsICh0d2lnX2dldF9hdHRyaWJ1dGUoJHRoaXMtPmVudiwgJHRoaXMtPnNvdXJjZSwgKGlzc2V0KCRjb250ZXh0WyJyZXF1ZXN0Il0pIHx8IGFycmF5X2tleV9leGlzdHMoInJlcXVlc3QiLCAkY29udGV4dCkgPyAkY29udGV4dFsicmVxdWVzdCJdIDogKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignVmFyaWFibGUgInJlcXVlc3QiIGRvZXMgbm90IGV4aXN0LicsIDM0NSwgJHRoaXMtPnNvdXJjZSk7IH0pKCkpLCAic2NoZW1lQW5kSHR0cEhvc3QiLCBbXSwgImFueSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDM0NSkgLiB0d2lnX2dldF9hdHRyaWJ1dGUoJHRoaXMtPmVudiwgJHRoaXMtPnNvdXJjZSwgKGlzc2V0KCRjb250ZXh0WyJyZXF1ZXN0Il0pIHx8IGFycmF5X2tleV9leGlzdHMoInJlcXVlc3QiLCAkY29udGV4dCkgPyAkY29udGV4dFsicmVxdWVzdCJdIDogKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignVmFyaWFibGUgInJlcXVlc3QiIGRvZXMgbm90IGV4aXN0LicsIDM0NSwgJHRoaXMtPnNvdXJjZSk7IH0pKCkpLCAiYmFzZVBhdGgiLCBbXSwgImFueSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDM0NSkpLCAianMiKSwgImh0bWwiLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgZWNobyAiJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHVybC5zdWJzdHIoIjsKICAgICAgICAgICAgLy8gbGluZSAzNDYKICAgICAgICAgICAgZWNobyB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgdHdpZ19sZW5ndGhfZmlsdGVyKCR0aGlzLT5lbnYsICh0d2lnX2dldF9hdHRyaWJ1dGUoJHRoaXMtPmVudiwgJHRoaXMtPnNvdXJjZSwgKGlzc2V0KCRjb250ZXh0WyJyZXF1ZXN0Il0pIHx8IGFycmF5X2tleV9leGlzdHMoInJlcXVlc3QiLCAkY29udGV4dCkgPyAkY29udGV4dFsicmVxdWVzdCJdIDogKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignVmFyaWFibGUgInJlcXVlc3QiIGRvZXMgbm90IGV4aXN0LicsIDM0NiwgJHRoaXMtPnNvdXJjZSk7IH0pKCkpLCAic2NoZW1lQW5kSHR0cEhvc3QiLCBbXSwgImFueSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDM0NikgLiB0d2lnX2dldF9hdHRyaWJ1dGUoJHRoaXMtPmVudiwgJHRoaXMtPnNvdXJjZSwgKGlzc2V0KCRjb250ZXh0WyJyZXF1ZXN0Il0pIHx8IGFycmF5X2tleV9leGlzdHMoInJlcXVlc3QiLCAkY29udGV4dCkgPyAkY29udGV4dFsicmVxdWVzdCJdIDogKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignVmFyaWFibGUgInJlcXVlc3QiIGRvZXMgbm90IGV4aXN0LicsIDM0NiwgJHRoaXMtPnNvdXJjZSk7IH0pKCkpLCAiYmFzZVBhdGgiLCBbXSwgImFueSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDM0NikpKSwgImh0bWwiLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgZWNobyAiKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghcGF0aC5tYXRjaChuZXcgUmVnRXhwKCI7CiAgICAgICAgICAgIC8vIGxpbmUgMzQ5CiAgICAgICAgICAgIGVjaG8ganNvbl9lbmNvZGUoKGlzc2V0KCRjb250ZXh0WyJleGNsdWRlZF9hamF4X3BhdGhzIl0pIHx8IGFycmF5X2tleV9leGlzdHMoImV4Y2x1ZGVkX2FqYXhfcGF0aHMiLCAkY29udGV4dCkgPyAkY29udGV4dFsiZXhjbHVkZWRfYWpheF9wYXRocyJdIDogKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignVmFyaWFibGUgImV4Y2x1ZGVkX2FqYXhfcGF0aHMiIGRvZXMgbm90IGV4aXN0LicsIDM0OSwgJHRoaXMtPnNvdXJjZSk7IH0pKCkpKTsKICAgICAgICAgICAgZWNobyAiKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YWNrRWxlbWVudCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAneGhyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gcmVxdWVzdFN0YWNrLnB1c2goc3RhY2tFbGVtZW50KSAtIDE7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWR5c3RhdGVjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnJlYWR5U3RhdGUgPT0gNCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5kdXJhdGlvbiA9IG5ldyBEYXRlKCkgLSBzdGFja0VsZW1lbnQuc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LmVycm9yID0gc2VsZi5zdGF0dXMgPCAyMDAgfHwgc2VsZi5zdGF0dXMgPj0gNDAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5zdGF0dXNDb2RlID0gc2VsZi5zdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdEhlYWRlcnMoc2VsZiwgc3RhY2tFbGVtZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRBamF4UmVxdWVzdChpZHgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcHJveGllZC5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAiOwogICAgICAgIH0KICAgICAgICAvLyBsaW5lIDM3OAogICAgICAgIGVjaG8gIgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGhhc0NsYXNzOiBoYXNDbGFzcywKCiAgICAgICAgICAgIHJlbW92ZUNsYXNzOiByZW1vdmVDbGFzcywKCiAgICAgICAgICAgIGFkZENsYXNzOiBhZGRDbGFzcywKCiAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiB0b2dnbGVDbGFzcywKCiAgICAgICAgICAgIGdldFByZWZlcmVuY2U6IGdldFByZWZlcmVuY2UsCgogICAgICAgICAgICBzZXRQcmVmZXJlbmNlOiBzZXRQcmVmZXJlbmNlLAoKICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogYWRkRXZlbnRMaXN0ZW5lciwKCiAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCgogICAgICAgICAgICByZW5kZXJBamF4UmVxdWVzdHM6IHJlbmRlckFqYXhSZXF1ZXN0cywKCiAgICAgICAgICAgIGxvYWQ6IGZ1bmN0aW9uKHNlbGVjdG9yLCB1cmwsIG9uU3VjY2Vzcywgb25FcnJvciwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZWN0b3IpOwoKICAgICAgICAgICAgICAgIGlmIChlbCAmJiBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2Z1cmwnKSAhPT0gdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCgKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmlubmVySFRNTCA9IHhoci5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2Z1cmwnLCB1cmwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoZWwsICdsb2FkaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGVuZGluZyA9IHBlbmRpbmdSZXF1ZXN0czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVxdWVzdFN0YWNrLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRBamF4UmVxdWVzdChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdFN0YWNrW2ldLmR1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmlzaEFqYXhSZXF1ZXN0KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIFJldmVydCB0aGUgcGVuZGluZyBzdGF0ZSBpbiBjYXNlIHRoZXJlIHdhcyBhIHN0YXJ0IGNhbGxlZCB3aXRob3V0IGEgZmluaXNoIGFib3ZlLiAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3RzID0gcGVuZGluZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvblN1Y2Nlc3MgfHwgbm9vcCkoeGhyLCBlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHhocikgeyAob25FcnJvciB8fCBub29wKSh4aHIsIGVsKTsgfSwKICAgICAgICAgICAgICAgICAgICAgICAgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbG9hZFRvb2xiYXI6IGZ1bmN0aW9uKHRva2VuLCBuZXdUb2tlbikgewogICAgICAgICAgICAgICAgbmV3VG9rZW4gPSAobmV3VG9rZW4gfHwgdG9rZW4pOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkKAogICAgICAgICAgICAgICAgICAgICdzZndkdCcgKyB0b2tlbiwKICAgICAgICAgICAgICAgICAgICAnIjsKICAgICAgICAvLyBsaW5lIDQzMgogICAgICAgIGVjaG8gdHdpZ19lc2NhcGVfZmlsdGVyKCR0aGlzLT5lbnYsIHR3aWdfZXNjYXBlX2ZpbHRlcigkdGhpcy0+ZW52LCAkdGhpcy0+ZXh0ZW5zaW9uc1snU3ltZm9ueVxCcmlkZ2VcVHdpZ1xFeHRlbnNpb25cUm91dGluZ0V4dGVuc2lvbiddLT5nZXRQYXRoKCJfd2R0IiwgWyJ0b2tlbiIgPT4gInh4eHh4eCJdKSwgImpzIiksICJodG1sIiwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgZWNobyAiJy5yZXBsYWNlKC94eHh4eHgvLCBuZXdUb2tlbiksCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oeGhyLCBlbCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyogRXZhbHVhdGUgaW4gZ2xvYmFsIHNjb3BlIHNjcmlwdHMgZW1iZWRkZWQgaW5zaWRlIHRoZSB0b29sYmFyICovCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpLCBzY3JpcHRzID0gW10uc2xpY2UuY2FsbChlbC5xdWVyeVNlbGVjdG9yQWxsKCdzY3JpcHQnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsLmNhbGwoe30sIHNjcmlwdHNbaV0uZmlyc3RDaGlsZC5ub2RlVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gLTEgIT09IHhoci5yZXNwb25zZVRleHQuaW5kZXhPZignc2YtdG9vbGJhcnJlc2V0JykgPyAnYmxvY2snIDogJ25vbmUnOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsLnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRQcmVmZXJlbmNlKCd0b29sYmFyL2Rpc3BsYXlTdGF0ZScpID09ICdub25lJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmVG9vbGJhck1haW5Db250ZW50LScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZk1pbmlUb29sYmFyLScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIG5ld1Rva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZNaW5pVG9vbGJhci0nICsgbmV3VG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIEhhbmRsZSB0b29sYmFyLWluZm8gcG9zaXRpb24gKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvb2xiYXJCbG9ja3MgPSBbXS5zbGljZS5jYWxsKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b29sYmFyLWJsb2NrJykpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9vbGJhckJsb2Nrcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckJsb2Nrc1tpXS5vbm1vdXNlb3ZlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbGJhckluZm8gPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b29sYmFyLWluZm8nKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZVdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudFdpZHRoID0gdG9vbGJhckluZm8ub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlZnRWYWx1ZSA9IChlbGVtZW50V2lkdGggKyB0aGlzLm9mZnNldExlZnQpIC0gcGFnZVdpZHRoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByaWdodFZhbHVlID0gKGVsZW1lbnRXaWR0aCArIChwYWdlV2lkdGggLSB0aGlzLm9mZnNldExlZnQpKSAtIHBhZ2VXaWR0aDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogUmVzZXQgcmlnaHQgYW5kIGxlZnQgdmFsdWUsIHVzZWZ1bCBvbiB3aW5kb3cgcmVzaXplICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUucmlnaHQgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFySW5mby5zdHlsZS5sZWZ0ID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50V2lkdGggPiBwYWdlV2lkdGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUubGVmdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxlZnRWYWx1ZSA+IDAgJiYgcmlnaHRWYWx1ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUucmlnaHQgPSAocmlnaHRWYWx1ZSAqIC0xKSArICdweCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsZWZ0VmFsdWUgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLmxlZnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLnJpZ2h0ID0gJzBweCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJIaWRlQnV0dG9uLScgKyBuZXdUb2tlbiksICdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHRoaXMucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgfHwgcC5wcmV2aW91c1NpYmxpbmcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZNaW5pVG9vbGJhci0nICsgbmV3VG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0UHJlZmVyZW5jZSgndG9vbGJhci9kaXNwbGF5U3RhdGUnLCAnbm9uZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWluaVRvZ2dsZXItJyArIG5ld1Rva2VuKSwgJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtID0gdGhpcy5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0uc3R5bGUuZGlzcGxheSA9PSAnbm9uZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIG5ld1Rva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIG5ld1Rva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyQ2xlYXJlci0nICsgbmV3VG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uc3R5bGUuZGlzcGxheSA9ICdub25lJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFByZWZlcmVuY2UoJ3Rvb2xiYXIvZGlzcGxheVN0YXRlJywgJ2Jsb2NrJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJBamF4UmVxdWVzdHMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1ibG9jay1hamF4JyksICdtb3VzZWVudGVyJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWJsb2NrLWFqYXggLnNmLXRvb2xiYXItaW5mbycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zY3JvbGxUb3AgPSBlbGVtLnNjcm9sbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stYWpheCA+IC5zZi10b29sYmFyLWljb24nKSwgJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHRoaXMucGFyZW50Tm9kZSwgJ2hvdmVyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGR1bXBJbmZvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stZHVtcCAuc2YtdG9vbGJhci1pbmZvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBkdW1wSW5mbykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkdW1wSW5mbywgJ3NmYmVmb3JlZHVtcGNvbGxhcHNlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1bXBJbmZvLnN0eWxlLm1pbkhlaWdodCA9IGR1bXBJbmZvLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCsncHgnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGR1bXBJbmZvLCAnbW91c2VsZWF2ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdW1wSW5mby5zdHlsZS5taW5IZWlnaHQgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZndkdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZndkdCcgKyB0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZndkdC5pbm5lckhUTUwgPSAnXFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2YtdG9vbGJhcnJlc2V0XCI+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNmLXRvb2xiYXItaWNvblwiPjxzdmcgd2lkdGg9XCIyNlwiIGhlaWdodD1cIjI4XCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZlcnNpb249XCIxLjFcIiB4PVwiMHB4XCIgeT1cIjBweFwiIHZpZXdCb3g9XCIwIDAgMjYgMjhcIiBlbmFibGUtYmFja2dyb3VuZD1cIm5ldyAwIDAgMjYgMjhcIiB4bWw6c3BhY2U9XCJwcmVzZXJ2ZVwiPjxwYXRoIGZpbGw9XCIjRkZGRkZGXCIgZD1cIk0xMyAwQzUuOCAwIDAgNS44IDAgMTNjMCA3LjIgNS44IDEzIDEzIDEzYzcuMiAwIDEzLTUuOCAxMy0xM0MyNiA1LjggMjAuMiAwIDEzIDB6IE0yMCA3LjUgYy0wLjYgMC0xLTAuMy0xLTAuOWMwLTAuMiAwLTAuNCAwLjItMC42YzAuMS0wLjMgMC4yLTAuMyAwLjItMC40YzAtMC4zLTAuNS0wLjQtMC43LTAuNGMtMiAwLjEtMi41IDIuNy0yLjkgNC44bC0wLjIgMS4xIGMxLjEgMC4yIDEuOSAwIDIuNC0wLjNjMC42LTAuNC0wLjItMC44LTAuMS0xLjNDMTggOS4yIDE4LjQgOSAxOC43IDguOWMwLjUgMCAwLjggMC41IDAuOCAxYzAgMC44LTEuMSAyLTMuMyAxLjkgYy0wLjMgMC0wLjUgMC0wLjctMC4xTDE1IDE0LjFjLTAuNCAxLjctMC45IDQuMS0yLjYgNi4yYy0xLjUgMS44LTMuMSAyLjEtMy44IDIuMWMtMS4zIDAtMi4xLTAuNi0yLjItMS42YzAtMC45IDAuOC0xLjQgMS4zLTEuNCBjMC43IDAgMS4yIDAuNSAxLjIgMS4xYzAgMC41LTAuMiAwLjYtMC40IDAuN2MtMC4xIDAuMS0wLjMgMC4yLTAuMyAwLjRjMCAwLjEgMC4xIDAuMyAwLjQgMC4zYzAuNSAwIDAuOS0wLjMgMS4yLTAuNSBjMS4zLTEgMS43LTIuOSAyLjQtNi4ybDAuMS0wLjhjMC4yLTEuMSAwLjUtMi4zIDAuOC0zLjVjLTAuOS0wLjctMS40LTEuNS0yLjYtMS44Yy0wLjgtMC4yLTEuMyAwLTEuNyAwLjRDOC40IDEwIDguNiAxMC43IDkgMTEuMSBsMC43IDAuN2MwLjggMC45IDEuMyAxLjcgMS4xIDIuN2MtMC4zIDEuNi0yLjEgMi44LTQuMyAyLjFjLTEuOS0wLjYtMi4yLTEuOS0yLTIuN2MwLjItMC42IDAuNy0wLjggMS4yLTAuNiBjMC41IDAuMiAwLjcgMC44IDAuNiAxLjNjMCAwLjEgMCAwLjEtMC4xIDAuM0M2IDE1IDUuOSAxNS4yIDUuOSAxNS4zYy0wLjEgMC40IDAuNCAwLjcgMC44IDAuOGMwLjggMC4zIDEuNy0wLjIgMS45LTAuOSBjMC4yLTAuNi0wLjItMS4xLTAuNC0xLjJsLTAuOC0wLjljLTAuNC0wLjQtMS4yLTEuNS0wLjgtMi44YzAuMi0wLjUgMC41LTEgMC45LTEuNGMxLTAuNyAyLTAuOCAzLTAuNmMxLjMgMC40IDEuOSAxLjIgMi44IDEuOSBjMC41LTEuMyAxLjEtMi42IDItMy44YzAuOS0xIDItMS43IDMuMy0xLjhDMjAgNC44IDIxIDUuNCAyMSA2LjNDMjEgNi43IDIwLjggNy41IDIwIDcuNXpcIi8+PC9zdmc+PC9kaXY+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgbG9hZGluZyB0aGUgd2ViIGRlYnVnIHRvb2xiYXIuIDxhIGhyZWY9XCIiOwogICAgICAgIC8vIGxpbmUgNTM1CiAgICAgICAgZWNobyB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgdHdpZ19lc2NhcGVfZmlsdGVyKCR0aGlzLT5lbnYsICR0aGlzLT5leHRlbnNpb25zWydTeW1mb255XEJyaWRnZVxUd2lnXEV4dGVuc2lvblxSb3V0aW5nRXh0ZW5zaW9uJ10tPmdldFBhdGgoIl9wcm9maWxlcl9ob21lIiksICJqcyIpLCAiaHRtbCIsIG51bGwsIHRydWUpOwogICAgICAgIGVjaG8gIicgKyBuZXdUb2tlbiArICc+T3BlbiB0aGUgd2ViIHByb2ZpbGVyLjwvYT5cXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Z3ZHQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdzZi10b29sYmFyIHNmLWVycm9yLXRvb2xiYXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgeyBtYXhUcmllczogNSB9CiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbihzZWxlY3RvciwgZWxPbiwgZWxPZmYpIHsKICAgICAgICAgICAgICAgIHZhciB0bXAgPSBlbE9uLnN0eWxlLmRpc3BsYXksCiAgICAgICAgICAgICAgICAgICAgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxlY3Rvcik7CgogICAgICAgICAgICAgICAgZWxPbi5zdHlsZS5kaXNwbGF5ID0gZWxPZmYuc3R5bGUuZGlzcGxheTsKICAgICAgICAgICAgICAgIGVsT2ZmLnN0eWxlLmRpc3BsYXkgPSB0bXA7CgogICAgICAgICAgICAgICAgaWYgKGVsKSB7CiAgICAgICAgICAgICAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJyA9PT0gdG1wID8gJ25vbmUnIDogJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNyZWF0ZVRhYnM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHRhYkdyb3VwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10YWJzOm5vdChbZGF0YS1wcm9jZXNzZWQ9dHJ1ZV0pJyk7CgogICAgICAgICAgICAgICAgLyogY3JlYXRlIHRoZSB0YWIgbmF2aWdhdGlvbiBmb3IgZWFjaCBncm91cCBvZiB0YWJzICovCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhYkdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHZhciB0YWJzID0gdGFiR3JvdXBzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJzpzY29wZSA+IC50YWInKTsKICAgICAgICAgICAgICAgICAgICB2YXIgdGFiTmF2aWdhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7CiAgICAgICAgICAgICAgICAgICAgdGFiTmF2aWdhdGlvbi5jbGFzc05hbWUgPSAndGFiLW5hdmlnYXRpb24nOwoKICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRUYWJJZCA9ICd0YWItJyArIGkgKyAnLTAnOyAvKiBzZWxlY3QgdGhlIGZpcnN0IHRhYiBieSBkZWZhdWx0ICovCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJJZCA9ICd0YWItJyArIGkgKyAnLScgKyBqOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFiVGl0bGUgPSB0YWJzW2pdLnF1ZXJ5U2VsZWN0b3IoJy50YWItdGl0bGUnKS5pbm5lckhUTUw7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFiTmF2aWdhdGlvbkl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgICAgICAgICAgICAgICAgICAgICB0YWJOYXZpZ2F0aW9uSXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGFiLWlkJywgdGFiSWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ2xhc3ModGFic1tqXSwgJ2FjdGl2ZScpKSB7IHNlbGVjdGVkVGFiSWQgPSB0YWJJZDsgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ2xhc3ModGFic1tqXSwgJ2Rpc2FibGVkJykpIHsgYWRkQ2xhc3ModGFiTmF2aWdhdGlvbkl0ZW0sICdkaXNhYmxlZCcpOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb25JdGVtLmlubmVySFRNTCA9IHRhYlRpdGxlOwogICAgICAgICAgICAgICAgICAgICAgICB0YWJOYXZpZ2F0aW9uLmFwcGVuZENoaWxkKHRhYk5hdmlnYXRpb25JdGVtKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJDb250ZW50ID0gdGFic1tqXS5xdWVyeVNlbGVjdG9yKCcudGFiLWNvbnRlbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGFiQ29udGVudC5wYXJlbnRFbGVtZW50LnNldEF0dHJpYnV0ZSgnaWQnLCB0YWJJZCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0YWJHcm91cHNbaV0uaW5zZXJ0QmVmb3JlKHRhYk5hdmlnYXRpb24sIHRhYkdyb3Vwc1tpXS5maXJzdENoaWxkKTsKICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS10YWItaWQ9XCInICsgc2VsZWN0ZWRUYWJJZCArICdcIl0nKSwgJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8qIGRpc3BsYXkgdGhlIGFjdGl2ZSB0YWIgYW5kIGFkZCB0aGUgJ2NsaWNrJyBldmVudCBsaXN0ZW5lcnMgKi8KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0YWJHcm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB0YWJOYXZpZ2F0aW9uID0gdGFiR3JvdXBzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJzpzY29wZSA+IC50YWItbmF2aWdhdGlvbiBsaScpOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgdGFiTmF2aWdhdGlvbi5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICB0YWJJZCA9IHRhYk5hdmlnYXRpb25bal0uZ2V0QXR0cmlidXRlKCdkYXRhLXRhYi1pZCcpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJJZCkucXVlcnlTZWxlY3RvcignLnRhYi10aXRsZScpLmNsYXNzTmFtZSA9ICdoaWRkZW4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0NsYXNzKHRhYk5hdmlnYXRpb25bal0sICdhY3RpdmUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFiSWQpLmNsYXNzTmFtZSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJJZCkuY2xhc3NOYW1lID0gJ2hpZGRlbic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb25bal0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlVGFiID0gZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIG5lZWRlZCBiZWNhdXNlIHdoZW4gdGhlIHRhYiBjb250YWlucyBIVE1MIGNvbnRlbnRzLCB1c2VyIGNhbiBjbGljayAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogb24gYW55IG9mIHRob3NlIGVsZW1lbnRzIGluc3RlYWQgb2YgdGhlaXIgcGFyZW50ICc8bGk+JyBlbGVtZW50ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYWN0aXZlVGFiLnRhZ05hbWUudG9Mb3dlckNhc2UoKSAhPT0gJ2xpJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhYiA9IGFjdGl2ZVRhYi5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGdldCB0aGUgZnVsbCBsaXN0IG9mIHRhYnMgdGhyb3VnaCB0aGUgcGFyZW50IG9mIHRoZSBhY3RpdmUgdGFiIGVsZW1lbnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJOYXZpZ2F0aW9uID0gYWN0aXZlVGFiLnBhcmVudE5vZGUuY2hpbGRyZW47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IHRhYk5hdmlnYXRpb24ubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFiSWQgPSB0YWJOYXZpZ2F0aW9uW2tdLmdldEF0dHJpYnV0ZSgnZGF0YS10YWItaWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJJZCkuY2xhc3NOYW1lID0gJ2hpZGRlbic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3ModGFiTmF2aWdhdGlvbltrXSwgJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGFjdGl2ZVRhYiwgJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2ZVRhYklkID0gYWN0aXZlVGFiLmdldEF0dHJpYnV0ZSgnZGF0YS10YWItaWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGFjdGl2ZVRhYklkKS5jbGFzc05hbWUgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRhYkdyb3Vwc1tpXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvY2Vzc2VkJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNyZWF0ZVRvZ2dsZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHRvZ2dsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2YtdG9nZ2xlOm5vdChbZGF0YS1wcm9jZXNzZWQ9dHJ1ZV0pJyk7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2dnbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRTZWxlY3RvciA9IHRvZ2dsZXNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1zZWxlY3RvcicpOwogICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50U2VsZWN0b3IpOwoKICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhlbGVtZW50LCAnc2YtdG9nZ2xlLWNvbnRlbnQnKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRvZ2dsZXNbaV0uaGFzQXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1pbml0aWFsJykgJiYgdG9nZ2xlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLWluaXRpYWwnKSA9PSAnZGlzcGxheScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3ModG9nZ2xlc1tpXSwgJ3NmLXRvZ2dsZS1vbicpOwogICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhlbGVtZW50LCAnc2YtdG9nZ2xlLXZpc2libGUnKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyh0b2dnbGVzW2ldLCAnc2YtdG9nZ2xlLW9mZicpOwogICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhlbGVtZW50LCAnc2YtdG9nZ2xlLWhpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcih0b2dnbGVzW2ldLCAnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgnJyAhPT0gd2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIERvbid0IGRvIGFueXRoaW5nIG9uIHRleHQgc2VsZWN0aW9uICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2dnbGUgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAvKiBuZWVkZWQgYmVjYXVzZSB3aGVuIHRoZSB0b2dnbGUgY29udGFpbnMgSFRNTCBjb250ZW50cywgdXNlciBjYW4gY2xpY2sgKi8KICAgICAgICAgICAgICAgICAgICAgICAgLyogb24gYW55IG9mIHRob3NlIGVsZW1lbnRzIGluc3RlYWQgb2YgdGhlaXIgcGFyZW50ICcuc2YtdG9nZ2xlJyBlbGVtZW50ICovCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICghaGFzQ2xhc3ModG9nZ2xlLCAnc2YtdG9nZ2xlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZSA9IHRvZ2dsZS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodG9nZ2xlLmdldEF0dHJpYnV0ZSgnZGF0YS10b2dnbGUtc2VsZWN0b3InKSk7CgogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyh0b2dnbGUsICdzZi10b2dnbGUtb24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3ModG9nZ2xlLCAnc2YtdG9nZ2xlLW9mZicpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhlbGVtZW50LCAnc2YtdG9nZ2xlLWhpZGRlbicpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhlbGVtZW50LCAnc2YtdG9nZ2xlLXZpc2libGUnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIHRoZSB0b2dnbGUgZG9lc24ndCBjaGFuZ2UgaXRzIGNvbnRlbnRzIHdoZW4gY2xpY2tpbmcgb24gaXQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0b2dnbGUuaGFzQXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1hbHQtY29udGVudCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdG9nZ2xlLmhhc0F0dHJpYnV0ZSgnZGF0YS10b2dnbGUtb3JpZ2luYWwtY29udGVudCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGUuc2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1vcmlnaW5hbC1jb250ZW50JywgdG9nZ2xlLmlubmVySFRNTCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Q29udGVudCA9IHRvZ2dsZS5pbm5lckhUTUw7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW5hbENvbnRlbnQgPSB0b2dnbGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1vcmlnaW5hbC1jb250ZW50Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbHRDb250ZW50ID0gdG9nZ2xlLmdldEF0dHJpYnV0ZSgnZGF0YS10b2dnbGUtYWx0LWNvbnRlbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlLmlubmVySFRNTCA9IGN1cnJlbnRDb250ZW50ICE9PSBhbHRDb250ZW50ID8gYWx0Q29udGVudCA6IG9yaWdpbmFsQ29udGVudDsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgLyogUHJldmVudHMgZnJvbSBkaXNhbGxvd2luZyBjbGlja3Mgb24gbGlua3MgaW5zaWRlIHRvZ2dsZXMgKi8KICAgICAgICAgICAgICAgICAgICB2YXIgdG9nZ2xlTGlua3MgPSB0b2dnbGVzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRvZ2dsZUxpbmtzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIodG9nZ2xlTGlua3Nbal0sICdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlc1tpXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvY2Vzc2VkJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNyZWF0ZUZpbHRlcnM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZmlsdGVyc10gW2RhdGEtZmlsdGVyXScpLmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikgewogICAgICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJzID0gZmlsdGVyLmNsb3Nlc3QoJ1tkYXRhLWZpbHRlcnNdJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAnY2hvaWNlJywKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGZpbHRlci5kYXRhc2V0LmZpbHRlciwKICAgICAgICAgICAgICAgICAgICAgICAgdWNOYW1lID0gbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKStuYW1lLnNsaWNlKDEpLAogICAgICAgICAgICAgICAgICAgICAgICBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gZmlsdGVycy5kYXRhc2V0WydmaWx0ZXInK3VjTmFtZV0gfHwgZmlsdGVycy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1maWx0ZXItJytuYW1lKyddJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVscyA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0cyA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ZWQgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkID0ge307CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZXMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAnbGV2ZWwnOwogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHMgPSB2YWx1ZXMuc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdmFsdWVzLnRvTG93ZXJDYXNlKCkuc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdHMgPSB2YWx1ZXMubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3MobGlzdCwgJ2ZpbHRlci1saXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3MobGlzdCwgJ2ZpbHRlci1saXN0LScrdHlwZSk7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmRhdGFzZXRbJ2ZpbHRlcicrdWNOYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW4gcHJvY2Vzc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IGkgaW4gbGFiZWxzID8gbGFiZWxzW2ldIDogdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmUgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgnJyA9PT0gbGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbi5pbm5lckhUTUwgPSAnPGVtPihub25lKTwvZW0+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbi5pbm5lclRleHQgPSBsYWJlbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24uZGF0YXNldC5maWx0ZXIgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAxID09PSAobWF0Y2hlcyA9IGZpbHRlcnMucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZmlsdGVyLScrbmFtZSsnPVwiJyt2YWx1ZSsnXCJdJykubGVuZ3RoKSA/ICdNYXRjaGVzIDEgcm93JyA6ICdNYXRjaGVzICcrbWF0Y2hlcysnIHJvd3MnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhlZFt2YWx1ZV0gPSBpOwogICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmFwcGVuZENoaWxkKG9wdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIob3B0aW9uLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ2Nob2ljZScgPT09IHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWZpbHRlci0nK25hbWUrJ10nKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbi5kYXRhc2V0LmZpbHRlciA9PT0gcm93LmRhdGFzZXRbJ2ZpbHRlcicrdWNOYW1lXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3Mocm93LCAnZmlsdGVyLWhpZGRlbi0nK25hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3Mob3B0aW9uLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCdsZXZlbCcgPT09IHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gdGhpcy5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY3RpdmUnKS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykuZm9yRWFjaChmdW5jdGlvbiAoY3VycmVudE9wdGlvbiwgaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA8PSBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhjdXJyZW50T3B0aW9uLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGN1cnJlbnRPcHRpb24sICdsYXN0LWFjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhjdXJyZW50T3B0aW9uLCAnbGFzdC1hY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGN1cnJlbnRPcHRpb24sICdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGN1cnJlbnRPcHRpb24sICdsYXN0LWFjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVycy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1maWx0ZXItJytuYW1lKyddJykuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpIDwgaW5kZXhlZFtyb3cuZGF0YXNldFsnZmlsdGVyJyt1Y05hbWVdXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3Mocm93LCAnZmlsdGVyLWhpZGRlbi0nK25hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3Mocm93LCAnZmlsdGVyLWhpZGRlbi0nK25hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ2Nob2ljZScgPT09IHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZSA9IG51bGwgPT09IGRlZmF1bHRzIHx8IDAgPD0gZGVmYXVsdHMuaW5kZXhPZih2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJ2xldmVsJyA9PT0gdHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlID0gaSA8PSBkZWZhdWx0czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmUgJiYgaSA9PT0gZGVmYXVsdHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhvcHRpb24sICdsYXN0LWFjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKG9wdGlvbiwgJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVycy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1maWx0ZXItJytuYW1lKyc9XCInK3ZhbHVlKydcIl0nKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhyb3csICdmaWx0ZXItaGlkZGVuLScrbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWRbdmFsdWVdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKDEgPCBsaXN0LmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5hcHBlbmRDaGlsZChsaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLmRhdGFzZXQuZmlsdGVyZWQgPSAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KSgpOwoKICAgIFNmanMuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwgJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICBTZmpzLmNyZWF0ZVRhYnMoKTsKICAgICAgICBTZmpzLmNyZWF0ZVRvZ2dsZXMoKTsKICAgIH0pOwoKLypdXT4qLzwvc2NyaXB0PgoiOwogICAgICAgIAogICAgICAgICRfX2ludGVybmFsXzA4NWIwMTQyODA2MjAyNTk5YzdmZTNiMzI5MTY0YTkyMzk3ZDg5NzgyMDdhMzdlNzlkNzBiOGM1MjU5OWUzM2UtPmxlYXZlKCRfX2ludGVybmFsXzA4NWIwMTQyODA2MjAyNTk5YzdmZTNiMzI5MTY0YTkyMzk3ZDg5NzgyMDdhMzdlNzlkNzBiOGM1MjU5OWUzM2VfcHJvZik7CgogICAgICAgIAogICAgICAgICRfX2ludGVybmFsXzMxOTM5MzQ2MTMwOTg5MjkyNGZmNmU3NGQ2ZDZlNjQyODdkZjY0YjYzNTQ1Yjk5NGUxMDBkNGFiMjIzYWVkMDItPmxlYXZlKCRfX2ludGVybmFsXzMxOTM5MzQ2MTMwOTg5MjkyNGZmNmU3NGQ2ZDZlNjQyODdkZjY0YjYzNTQ1Yjk5NGUxMDBkNGFiMjIzYWVkMDJfcHJvZik7CgogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUZW1wbGF0ZU5hbWUoKQogICAgewogICAgICAgIHJldHVybiAiQFdlYlByb2ZpbGVyL1Byb2ZpbGVyL2Jhc2VfanMuaHRtbC50d2lnIjsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNUcmFpdGFibGUoKQogICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVidWdJbmZvKCkKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkgKCAgNjA4ID0+IDUzNSwgIDUwMiA9PiA0MzIsICA0NDYgPT4gMzc4LCAgNDE0ID0+IDM0OSwgIDQwOCA9PiAzNDYsICA0MDQgPT4gMzQ1LCAgMzk4ID0+IDM0MiwgIDM5NCA9PiAzNDEsICAzNDggPT4gMjk4LCAgMzI3ID0+IDI3OSwgIDMyNSA9PiAyNzgsICA1MiA9PiA3LCAgNDMgPT4gMywpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTb3VyY2VDb250ZXh0KCkKICAgIHsKICAgICAgICByZXR1cm4gbmV3IFNvdXJjZSgieyMgVGhpcyBmaWxlIGlzIHBhcnRpYWxseSBkdXBsaWNhdGVkIGluIFR3aWdCdW5kbGUvUmVzb3VyY2VzL3ZpZXdzL2Jhc2VfanMuaHRtbC50d2lnLiBJZiB5b3UKICAgbWFrZSBhbnkgY2hhbmdlIGluIHRoaXMgZmlsZSwgdmVyaWZ5IHRoZSBzYW1lIGNoYW5nZSBpcyBuZWVkZWQgaW4gdGhlIG90aGVyIGZpbGUuICN9CjxzY3JpcHR7JSBpZiBjc3Bfc2NyaXB0X25vbmNlIGlzIGRlZmluZWQgYW5kIGNzcF9zY3JpcHRfbm9uY2UgJX0gbm9uY2U9XCJ7eyBjc3Bfc2NyaXB0X25vbmNlIH19XCJ7JSBlbmRpZiAlfT4vKjwhW0NEQVRBWyovCiAgICB7IyBDYXV0aW9uOiB0aGUgY29udGVudHMgb2YgdGhpcyBmaWxlIGFyZSBwcm9jZXNzZWQgYnkgVHdpZyBiZWZvcmUgbG9hZGluZwogICAgICAgICAgICAgICAgdGhlbSBhcyBKYXZhU2NyaXB0IHNvdXJjZSBjb2RlLiBBbHdheXMgdXNlICcvKicgY29tbWVudHMgaW5zdGVhZAogICAgICAgICAgICAgICAgb2YgJy8vJyBjb21tZW50cyB0byBhdm9pZCBpbXBvc3NpYmxlLXRvLWRlYnVnIHNpZGUtZWZmZWN0cyAjfQoKICAgIFNmanMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7CgogICAgICAgIGlmICgnY2xhc3NMaXN0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyIGhhc0NsYXNzID0gZnVuY3Rpb24gKGVsLCBjc3NDbGFzcykgeyByZXR1cm4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNzc0NsYXNzKTsgfTsKICAgICAgICAgICAgdmFyIHJlbW92ZUNsYXNzID0gZnVuY3Rpb24oZWwsIGNzc0NsYXNzKSB7IGVsLmNsYXNzTGlzdC5yZW1vdmUoY3NzQ2xhc3MpOyB9OwogICAgICAgICAgICB2YXIgYWRkQ2xhc3MgPSBmdW5jdGlvbihlbCwgY3NzQ2xhc3MpIHsgZWwuY2xhc3NMaXN0LmFkZChjc3NDbGFzcyk7IH07CiAgICAgICAgICAgIHZhciB0b2dnbGVDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBlbC5jbGFzc0xpc3QudG9nZ2xlKGNzc0NsYXNzKTsgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgaGFzQ2xhc3MgPSBmdW5jdGlvbiAoZWwsIGNzc0NsYXNzKSB7IHJldHVybiBlbC5jbGFzc05hbWUubWF0Y2gobmV3IFJlZ0V4cCgnXFxcXGInICsgY3NzQ2xhc3MgKyAnXFxcXGInKSk7IH07CiAgICAgICAgICAgIHZhciByZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUucmVwbGFjZShuZXcgUmVnRXhwKCdcXFxcYicgKyBjc3NDbGFzcyArICdcXFxcYicpLCAnICcpOyB9OwogICAgICAgICAgICB2YXIgYWRkQ2xhc3MgPSBmdW5jdGlvbihlbCwgY3NzQ2xhc3MpIHsgaWYgKCFoYXNDbGFzcyhlbCwgY3NzQ2xhc3MpKSB7IGVsLmNsYXNzTmFtZSArPSBcIiBcIiArIGNzc0NsYXNzOyB9IH07CiAgICAgICAgICAgIHZhciB0b2dnbGVDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBoYXNDbGFzcyhlbCwgY3NzQ2xhc3MpID8gcmVtb3ZlQ2xhc3MoZWwsIGNzc0NsYXNzKSA6IGFkZENsYXNzKGVsLCBjc3NDbGFzcyk7IH07CiAgICAgICAgfQoKICAgICAgICB2YXIgbm9vcCA9IGZ1bmN0aW9uKCkge307CgogICAgICAgIHZhciBwcm9maWxlclN0b3JhZ2VLZXkgPSAnc3ltZm9ueS9wcm9maWxlci8nOwoKICAgICAgICB2YXIgYWRkRXZlbnRMaXN0ZW5lcjsKCiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgaWYgKCEoJ2FkZEV2ZW50TGlzdGVuZXInIGluIGVsKSkgewogICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50TmFtZSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0YWNoRXZlbnQoJ29uJyArIGV2ZW50TmFtZSwgY2FsbGJhY2spOwogICAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnROYW1lLCBjYWxsYmFjaykgewogICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgY2FsbGJhY2ssIGZhbHNlKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHZhciByZXF1ZXN0ID0gZnVuY3Rpb24odXJsLCBvblN1Y2Nlc3MsIG9uRXJyb3IsIHBheWxvYWQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHhociA9IHdpbmRvdy5YTUxIdHRwUmVxdWVzdCA/IG5ldyBYTUxIdHRwUmVxdWVzdCgpIDogbmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxIVFRQJyk7CiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgICBvcHRpb25zLm1heFRyaWVzID0gb3B0aW9ucy5tYXhUcmllcyB8fCAwOwogICAgICAgICAgICB4aHIub3BlbihvcHRpb25zLm1ldGhvZCB8fCAnR0VUJywgdXJsLCB0cnVlKTsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCAnWE1MSHR0cFJlcXVlc3QnKTsKICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAgICAgICAgICAgICBpZiAoNCAhPT0geGhyLnJlYWR5U3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PSA0MDQgJiYgb3B0aW9ucy5tYXhUcmllcyA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubWF4VHJpZXMtLTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCh1cmwsIG9uU3VjY2Vzcywgb25FcnJvciwgcGF5bG9hZCwgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgyMDAgPT09IHhoci5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAob25TdWNjZXNzIHx8IG5vb3ApKHhocik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIChvbkVycm9yIHx8IG5vb3ApKHhocik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHhoci5zZW5kKHBheWxvYWQgfHwgJycpOwogICAgICAgIH07CgogICAgICAgIHZhciBnZXRQcmVmZXJlbmNlID0gZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocHJvZmlsZXJTdG9yYWdlS2V5ICsgbmFtZSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHNldFByZWZlcmVuY2UgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShwcm9maWxlclN0b3JhZ2VLZXkgKyBuYW1lLCB2YWx1ZSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHJlcXVlc3RTdGFjayA9IFtdOwoKICAgICAgICB2YXIgZXh0cmFjdEhlYWRlcnMgPSBmdW5jdGlvbih4aHIsIHN0YWNrRWxlbWVudCkgewogICAgICAgICAgICAvKiBIZXJlIHdlIGF2b2lkIHRvIGNhbGwgeGhyLmdldFJlc3BvbnNlSGVhZGVyIGluIG9yZGVyIHRvICovCiAgICAgICAgICAgIC8qIHByZXZlbnQgcG9sbHV0aW5nIHRoZSBjb25zb2xlIHdpdGggQ09SUyBzZWN1cml0eSBlcnJvcnMgKi8KICAgICAgICAgICAgdmFyIGFsbEhlYWRlcnMgPSB4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCk7CiAgICAgICAgICAgIHZhciByZXQ7CgogICAgICAgICAgICBpZiAocmV0ID0gYWxsSGVhZGVycy5tYXRjaCgvXngtZGVidWctdG9rZW46XFxzKyguKilcJC9pbSkpIHsKICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5wcm9maWxlID0gcmV0WzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXQgPSBhbGxIZWFkZXJzLm1hdGNoKC9eeC1kZWJ1Zy10b2tlbi1saW5rOlxccysoLiopXCQvaW0pKSB7CiAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQucHJvZmlsZXJVcmwgPSByZXRbMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJldCA9IGFsbEhlYWRlcnMubWF0Y2goL15TeW1mb255LURlYnVnLVRvb2xiYXItUmVwbGFjZTpcXHMrKC4qKVwkL2ltKSkgewogICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnRvb2xiYXJSZXBsYWNlRmluaXNoZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC50b29sYmFyUmVwbGFjZSA9ICcxJyA9PT0gcmV0WzFdOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHN1Y2Nlc3NTdHJlYWsgPSA0OwogICAgICAgIHZhciBwZW5kaW5nUmVxdWVzdHMgPSAwOwogICAgICAgIHZhciByZW5kZXJBamF4UmVxdWVzdHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHJlcXVlc3RDb3VudGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYWpheC1yZXF1ZXN0LWNvdW50ZXInKTsKICAgICAgICAgICAgaWYgKCFyZXF1ZXN0Q291bnRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcXVlc3RDb3VudGVyLnRleHRDb250ZW50ID0gcmVxdWVzdFN0YWNrLmxlbmd0aDsKCiAgICAgICAgICAgIHZhciBpbmZvU3BhbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2YtdG9vbGJhci1hamF4LWluZm9cIik7CiAgICAgICAgICAgIGlmIChpbmZvU3BhbikgewogICAgICAgICAgICAgICAgaW5mb1NwYW4udGV4dENvbnRlbnQgPSByZXF1ZXN0U3RhY2subGVuZ3RoICsgJyBBSkFYIHJlcXVlc3QnICsgKHJlcXVlc3RTdGFjay5sZW5ndGggIT09IDEgPyAncycgOiAnJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhamF4VG9vbGJhclBhbmVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stYWpheCcpOwogICAgICAgICAgICBpZiAocmVxdWVzdFN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICAgICAgYWpheFRvb2xiYXJQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFqYXhUb29sYmFyUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGVuZGluZ1JlcXVlc3RzID4gMCkgewogICAgICAgICAgICAgICAgYWRkQ2xhc3MoYWpheFRvb2xiYXJQYW5lbCwgJ3NmLWFqYXgtcmVxdWVzdC1sb2FkaW5nJyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VjY2Vzc1N0cmVhayA8IDQpIHsKICAgICAgICAgICAgICAgIGFkZENsYXNzKGFqYXhUb29sYmFyUGFuZWwsICdzZi10b29sYmFyLXN0YXR1cy1yZWQnKTsKICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGFqYXhUb29sYmFyUGFuZWwsICdzZi1hamF4LXJlcXVlc3QtbG9hZGluZycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoYWpheFRvb2xiYXJQYW5lbCwgJ3NmLWFqYXgtcmVxdWVzdC1sb2FkaW5nJyk7CiAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhhamF4VG9vbGJhclBhbmVsLCAnc2YtdG9vbGJhci1zdGF0dXMtcmVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYWpheC1jbGVhcicpLCAnY2xpY2snLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJlcXVlc3RTdGFjayA9IFtdOwogICAgICAgICAgICAgICAgcmVuZGVyQWpheFJlcXVlc3RzKCk7CiAgICAgICAgICAgICAgICBzdWNjZXNzU3RyZWFrID0gNDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWFqYXgtcmVxdWVzdC1saXN0JykuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIHZhciBzdGFydEFqYXhSZXF1ZXN0ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYWpheC1yZXF1ZXN0LWxpc3QnKTsKICAgICAgICAgICAgaWYgKCF0Ym9keSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbmJPZkFqYXhSZXF1ZXN0ID0gdGJvZHkucm93cy5sZW5ndGg7CiAgICAgICAgICAgIGlmIChuYk9mQWpheFJlcXVlc3QgPj0gMTAwKSB7CiAgICAgICAgICAgICAgICB0Ym9keS5kZWxldGVSb3coMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gcmVxdWVzdFN0YWNrW2luZGV4XTsKICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3RzKys7CiAgICAgICAgICAgIHZhciByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOwogICAgICAgICAgICByZXF1ZXN0LkRPTU5vZGUgPSByb3c7CgogICAgICAgICAgICB2YXIgcmVxdWVzdE51bWJlckNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICByZXF1ZXN0TnVtYmVyQ2VsbC50ZXh0Q29udGVudCA9IGluZGV4ICsgMTsKICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHJlcXVlc3ROdW1iZXJDZWxsKTsKCiAgICAgICAgICAgIHZhciBwcm9maWxlckNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICBwcm9maWxlckNlbGwudGV4dENvbnRlbnQgPSAnbi9hJzsKICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHByb2ZpbGVyQ2VsbCk7CgogICAgICAgICAgICB2YXIgbWV0aG9kQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgIG1ldGhvZENlbGwudGV4dENvbnRlbnQgPSByZXF1ZXN0Lm1ldGhvZDsKICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKG1ldGhvZENlbGwpOwoKICAgICAgICAgICAgdmFyIHR5cGVDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgdHlwZUNlbGwudGV4dENvbnRlbnQgPSByZXF1ZXN0LnR5cGU7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZCh0eXBlQ2VsbCk7CgogICAgICAgICAgICB2YXIgc3RhdHVzQ29kZUNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICB2YXIgc3RhdHVzQ29kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgc3RhdHVzQ29kZS50ZXh0Q29udGVudCA9ICduL2EnOwogICAgICAgICAgICBzdGF0dXNDb2RlQ2VsbC5hcHBlbmRDaGlsZChzdGF0dXNDb2RlKTsKICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHN0YXR1c0NvZGVDZWxsKTsKCiAgICAgICAgICAgIHZhciBwYXRoQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgIHBhdGhDZWxsLmNsYXNzTmFtZSA9ICdzZi1hamF4LXJlcXVlc3QtdXJsJzsKICAgICAgICAgICAgaWYgKCdHRVQnID09PSByZXF1ZXN0Lm1ldGhvZCkgewogICAgICAgICAgICAgICAgdmFyIHBhdGhMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICAgICAgcGF0aExpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgcmVxdWVzdC51cmwpOwogICAgICAgICAgICAgICAgcGF0aExpbmsudGV4dENvbnRlbnQgPSByZXF1ZXN0LnVybDsKICAgICAgICAgICAgICAgIHBhdGhDZWxsLmFwcGVuZENoaWxkKHBhdGhMaW5rKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhdGhDZWxsLnRleHRDb250ZW50ID0gcmVxdWVzdC51cmw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGF0aENlbGwuc2V0QXR0cmlidXRlKCd0aXRsZScsIHJlcXVlc3QudXJsKTsKICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHBhdGhDZWxsKTsKCiAgICAgICAgICAgIHZhciBkdXJhdGlvbkNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICBkdXJhdGlvbkNlbGwuY2xhc3NOYW1lID0gJ3NmLWFqYXgtcmVxdWVzdC1kdXJhdGlvbic7CiAgICAgICAgICAgIGR1cmF0aW9uQ2VsbC50ZXh0Q29udGVudCA9ICduL2EnOwogICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQoZHVyYXRpb25DZWxsKTsKCiAgICAgICAgICAgIHJlcXVlc3QubGl2ZUR1cmF0aW9uSGFuZGxlID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkdXJhdGlvbkNlbGwudGV4dENvbnRlbnQgPSAobmV3IERhdGUoKSAtIHJlcXVlc3Quc3RhcnQpICsgJ21zJzsKICAgICAgICAgICAgfSwgMTAwKTsKCiAgICAgICAgICAgIHJvdy5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0IHNmLWFqYXgtcmVxdWVzdC1sb2FkaW5nJzsKICAgICAgICAgICAgdGJvZHkuaW5zZXJ0QmVmb3JlKHJvdywgbnVsbCk7CgogICAgICAgICAgICB2YXIgdG9vbGJhckluZm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1ibG9jay1hamF4IC5zZi10b29sYmFyLWluZm8nKTsKICAgICAgICAgICAgdG9vbGJhckluZm8uc2Nyb2xsVG9wID0gdG9vbGJhckluZm8uc2Nyb2xsSGVpZ2h0OwoKICAgICAgICAgICAgcmVuZGVyQWpheFJlcXVlc3RzKCk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGZpbmlzaEFqYXhSZXF1ZXN0ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSByZXF1ZXN0U3RhY2tbaW5kZXhdOwogICAgICAgICAgICBjbGVhckludGVydmFsKHJlcXVlc3QubGl2ZUR1cmF0aW9uSGFuZGxlKTsKCiAgICAgICAgICAgIGlmICghcmVxdWVzdC5ET01Ob2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnRvb2xiYXJSZXBsYWNlICYmICFyZXF1ZXN0LnRvb2xiYXJSZXBsYWNlRmluaXNoZWQgJiYgcmVxdWVzdC5wcm9maWxlKSB7CiAgICAgICAgICAgICAgICAvKiBGbGFnIGFzIGNvbXBsZXRlIGJlY2F1c2UgZmluaXNoQWpheFJlcXVlc3QgY2FuIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcy4gKi8KICAgICAgICAgICAgICAgIHJlcXVlc3QudG9vbGJhclJlcGxhY2VGaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAvKiBTZWFyY2ggdXAgdGhyb3VnaCB0aGUgRE9NIHRvIGZpbmQgdGhlIHRvb2xiYXIncyBjb250YWluZXIgSUQuICovCiAgICAgICAgICAgICAgICBmb3IgKHZhciBlbGVtID0gcmVxdWVzdC5ET01Ob2RlOyBlbGVtICYmIGVsZW0gIT09IGRvY3VtZW50OyBlbGVtID0gZWxlbS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0uaWQubWF0Y2goL15zZndkdC8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFNmanMubG9hZFRvb2xiYXIoZWxlbS5pZC5yZXBsYWNlKC9ec2Z3ZHQvLCAnJyksIHJlcXVlc3QucHJvZmlsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3RzLS07CiAgICAgICAgICAgIHZhciByb3cgPSByZXF1ZXN0LkRPTU5vZGU7CiAgICAgICAgICAgIC8qIFVucGFjayB0aGUgY2hpbGRyZW4gZnJvbSB0aGUgcm93ICovCiAgICAgICAgICAgIHZhciBwcm9maWxlckNlbGwgPSByb3cuY2hpbGRyZW5bMV07CiAgICAgICAgICAgIHZhciBtZXRob2RDZWxsID0gcm93LmNoaWxkcmVuWzJdOwogICAgICAgICAgICB2YXIgc3RhdHVzQ29kZUNlbGwgPSByb3cuY2hpbGRyZW5bNF07CiAgICAgICAgICAgIHZhciBzdGF0dXNDb2RlRWxlbSA9IHN0YXR1c0NvZGVDZWxsLmNoaWxkcmVuWzBdOwogICAgICAgICAgICB2YXIgZHVyYXRpb25DZWxsID0gcm93LmNoaWxkcmVuWzZdOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QuZXJyb3IpIHsKICAgICAgICAgICAgICAgIHJvdy5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0IHNmLWFqYXgtcmVxdWVzdC1lcnJvcic7CiAgICAgICAgICAgICAgICBtZXRob2RDZWxsLmNsYXNzTmFtZSA9ICdzZi1hamF4LXJlcXVlc3QtZXJyb3InOwogICAgICAgICAgICAgICAgc3VjY2Vzc1N0cmVhayA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3cuY2xhc3NOYW1lID0gJ3NmLWFqYXgtcmVxdWVzdCBzZi1hamF4LXJlcXVlc3Qtb2snOwogICAgICAgICAgICAgICAgc3VjY2Vzc1N0cmVhaysrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXNDb2RlKSB7CiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXNDb2RlIDwgMzAwKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZUVsZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsICdzZi10b29sYmFyLXN0YXR1cycpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0LnN0YXR1c0NvZGUgPCA0MDApIHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlRWxlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3NmLXRvb2xiYXItc3RhdHVzIHNmLXRvb2xiYXItc3RhdHVzLXllbGxvdycpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlRWxlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3NmLXRvb2xiYXItc3RhdHVzIHNmLXRvb2xiYXItc3RhdHVzLXJlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdHVzQ29kZUVsZW0udGV4dENvbnRlbnQgPSByZXF1ZXN0LnN0YXR1c0NvZGU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGF0dXNDb2RlRWxlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3NmLXRvb2xiYXItc3RhdHVzIHNmLXRvb2xiYXItc3RhdHVzLXJlZCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdC5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgZHVyYXRpb25DZWxsLnRleHRDb250ZW50ID0gcmVxdWVzdC5kdXJhdGlvbiArICdtcyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnByb2ZpbGVyVXJsKSB7CiAgICAgICAgICAgICAgICBwcm9maWxlckNlbGwudGV4dENvbnRlbnQgPSAnJzsKICAgICAgICAgICAgICAgIHZhciBwcm9maWxlckxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICBwcm9maWxlckxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgcmVxdWVzdC5wcm9maWxlclVybCk7CiAgICAgICAgICAgICAgICBwcm9maWxlckxpbmsudGV4dENvbnRlbnQgPSByZXF1ZXN0LnByb2ZpbGU7CiAgICAgICAgICAgICAgICBwcm9maWxlckNlbGwuYXBwZW5kQ2hpbGQocHJvZmlsZXJMaW5rKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVuZGVyQWpheFJlcXVlc3RzKCk7CiAgICAgICAgfTsKCiAgICAgICAgeyUgaWYgZXhjbHVkZWRfYWpheF9wYXRocyBpcyBkZWZpbmVkICV9CiAgICAgICAgICAgIGlmICh3aW5kb3cuZmV0Y2ggJiYgd2luZG93LmZldGNoLnBvbHlmaWxsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBvbGRGZXRjaCA9IHdpbmRvdy5mZXRjaDsKICAgICAgICAgICAgICAgIHdpbmRvdy5mZXRjaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG9sZEZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IGFyZ3VtZW50c1swXTsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gYXJndW1lbnRzWzFdOwogICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbVR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJndW1lbnRzWzBdKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1UeXBlID09PSAnW29iamVjdCBSZXF1ZXN0XScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gYXJndW1lbnRzWzBdLnVybDsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBhcmd1bWVudHNbMF0ubWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6IGFyZ3VtZW50c1swXS5jcmVkZW50aWFscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGFyZ3VtZW50c1swXS5oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogYXJndW1lbnRzWzBdLm1vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDogYXJndW1lbnRzWzBdLnJlZGlyZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gU3RyaW5nKHVybCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghdXJsLm1hdGNoKG5ldyBSZWdFeHAoe3sgZXhjbHVkZWRfYWpheF9wYXRoc3xqc29uX2VuY29kZXxyYXcgfX0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gJ0dFVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMgJiYgcGFyYW1zLm1ldGhvZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSBwYXJhbXMubWV0aG9kOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhY2tFbGVtZW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmZXRjaCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogbmV3IERhdGUoKQogICAgICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHJlcXVlc3RTdGFjay5wdXNoKHN0YWNrRWxlbWVudCkgLSAxOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5kdXJhdGlvbiA9IG5ldyBEYXRlKCkgLSBzdGFja0VsZW1lbnQuc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuZXJyb3IgPSByLnN0YXR1cyA8IDIwMCB8fCByLnN0YXR1cyA+PSA0MDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuc3RhdHVzQ29kZSA9IHIuc3RhdHVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnByb2ZpbGUgPSByLmhlYWRlcnMuZ2V0KCd4LWRlYnVnLXRva2VuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQucHJvZmlsZXJVcmwgPSByLmhlYWRlcnMuZ2V0KCd4LWRlYnVnLXRva2VuLWxpbmsnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC50b29sYmFyUmVwbGFjZUZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQudG9vbGJhclJlcGxhY2UgPSAnMScgPT09IHIuaGVhZGVycy5nZXQoJ1N5bWZvbnktRGVidWctVG9vbGJhci1SZXBsYWNlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2hBamF4UmVxdWVzdChpZHgpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0QWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0ICYmIFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJveGllZCA9IFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuOwoKICAgICAgICAgICAgICAgIFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24obWV0aG9kLCB1cmwsIGFzeW5jLCB1c2VyLCBwYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgICAgICAgICAvKiBwcmV2ZW50IGxvZ2dpbmcgQUpBWCBjYWxscyB0byBzdGF0aWMgYW5kIGlubGluZSBmaWxlcywgbGlrZSB0ZW1wbGF0ZXMgKi8KICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IHVybDsKICAgICAgICAgICAgICAgICAgICBpZiAodXJsLnN1YnN0cigwLCAxKSA9PT0gJy8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID09PSB1cmwuaW5kZXhPZigne3sgcmVxdWVzdC5iYXNlUGF0aHxlKCdqcycpIH19JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSB1cmwuc3Vic3RyKHt7IHJlcXVlc3QuYmFzZVBhdGh8bGVuZ3RoIH19KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgwID09PSB1cmwuaW5kZXhPZigne3sgKHJlcXVlc3Quc2NoZW1lQW5kSHR0cEhvc3QgfiByZXF1ZXN0LmJhc2VQYXRoKXxlKCdqcycpIH19JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHVybC5zdWJzdHIoe3sgKHJlcXVlc3Quc2NoZW1lQW5kSHR0cEhvc3QgfiByZXF1ZXN0LmJhc2VQYXRoKXxsZW5ndGggfX0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXRoLm1hdGNoKG5ldyBSZWdFeHAoe3sgZXhjbHVkZWRfYWpheF9wYXRoc3xqc29uX2VuY29kZXxyYXcgfX0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhY2tFbGVtZW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd4aHInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG5ldyBEYXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSByZXF1ZXN0U3RhY2sucHVzaChzdGFja0VsZW1lbnQpIC0gMTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYucmVhZHlTdGF0ZSA9PSA0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LmR1cmF0aW9uID0gbmV3IERhdGUoKSAtIHN0YWNrRWxlbWVudC5zdGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuZXJyb3IgPSBzZWxmLnN0YXR1cyA8IDIwMCB8fCBzZWxmLnN0YXR1cyA+PSA0MDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnN0YXR1c0NvZGUgPSBzZWxmLnN0YXR1czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0SGVhZGVycyhzZWxmLCBzdGFja0VsZW1lbnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2hBamF4UmVxdWVzdChpZHgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7CgogICAgICAgICAgICAgICAgICAgICAgICBzdGFydEFqYXhSZXF1ZXN0KGlkeCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwcm94aWVkLmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIHslIGVuZGlmICV9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGhhc0NsYXNzOiBoYXNDbGFzcywKCiAgICAgICAgICAgIHJlbW92ZUNsYXNzOiByZW1vdmVDbGFzcywKCiAgICAgICAgICAgIGFkZENsYXNzOiBhZGRDbGFzcywKCiAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiB0b2dnbGVDbGFzcywKCiAgICAgICAgICAgIGdldFByZWZlcmVuY2U6IGdldFByZWZlcmVuY2UsCgogICAgICAgICAgICBzZXRQcmVmZXJlbmNlOiBzZXRQcmVmZXJlbmNlLAoKICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogYWRkRXZlbnRMaXN0ZW5lciwKCiAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCgogICAgICAgICAgICByZW5kZXJBamF4UmVxdWVzdHM6IHJlbmRlckFqYXhSZXF1ZXN0cywKCiAgICAgICAgICAgIGxvYWQ6IGZ1bmN0aW9uKHNlbGVjdG9yLCB1cmwsIG9uU3VjY2Vzcywgb25FcnJvciwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZWN0b3IpOwoKICAgICAgICAgICAgICAgIGlmIChlbCAmJiBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2Z1cmwnKSAhPT0gdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCgKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmlubmVySFRNTCA9IHhoci5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2Z1cmwnLCB1cmwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoZWwsICdsb2FkaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGVuZGluZyA9IHBlbmRpbmdSZXF1ZXN0czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVxdWVzdFN0YWNrLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRBamF4UmVxdWVzdChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdFN0YWNrW2ldLmR1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmlzaEFqYXhSZXF1ZXN0KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIFJldmVydCB0aGUgcGVuZGluZyBzdGF0ZSBpbiBjYXNlIHRoZXJlIHdhcyBhIHN0YXJ0IGNhbGxlZCB3aXRob3V0IGEgZmluaXNoIGFib3ZlLiAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3RzID0gcGVuZGluZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvblN1Y2Nlc3MgfHwgbm9vcCkoeGhyLCBlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHhocikgeyAob25FcnJvciB8fCBub29wKSh4aHIsIGVsKTsgfSwKICAgICAgICAgICAgICAgICAgICAgICAgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbG9hZFRvb2xiYXI6IGZ1bmN0aW9uKHRva2VuLCBuZXdUb2tlbikgewogICAgICAgICAgICAgICAgbmV3VG9rZW4gPSAobmV3VG9rZW4gfHwgdG9rZW4pOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkKAogICAgICAgICAgICAgICAgICAgICdzZndkdCcgKyB0b2tlbiwKICAgICAgICAgICAgICAgICAgICAne3sgcGF0aChcIl93ZHRcIiwgeyBcInRva2VuXCI6IFwieHh4eHh4XCIgfSl8ZXNjYXBlKCdqcycpIH19Jy5yZXBsYWNlKC94eHh4eHgvLCBuZXdUb2tlbiksCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oeGhyLCBlbCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyogRXZhbHVhdGUgaW4gZ2xvYmFsIHNjb3BlIHNjcmlwdHMgZW1iZWRkZWQgaW5zaWRlIHRoZSB0b29sYmFyICovCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpLCBzY3JpcHRzID0gW10uc2xpY2UuY2FsbChlbC5xdWVyeVNlbGVjdG9yQWxsKCdzY3JpcHQnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsLmNhbGwoe30sIHNjcmlwdHNbaV0uZmlyc3RDaGlsZC5ub2RlVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gLTEgIT09IHhoci5yZXNwb25zZVRleHQuaW5kZXhPZignc2YtdG9vbGJhcnJlc2V0JykgPyAnYmxvY2snIDogJ25vbmUnOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsLnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRQcmVmZXJlbmNlKCd0b29sYmFyL2Rpc3BsYXlTdGF0ZScpID09ICdub25lJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmVG9vbGJhck1haW5Db250ZW50LScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZk1pbmlUb29sYmFyLScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIG5ld1Rva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZNaW5pVG9vbGJhci0nICsgbmV3VG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIEhhbmRsZSB0b29sYmFyLWluZm8gcG9zaXRpb24gKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvb2xiYXJCbG9ja3MgPSBbXS5zbGljZS5jYWxsKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b29sYmFyLWJsb2NrJykpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9vbGJhckJsb2Nrcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckJsb2Nrc1tpXS5vbm1vdXNlb3ZlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbGJhckluZm8gPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b29sYmFyLWluZm8nKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZVdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudFdpZHRoID0gdG9vbGJhckluZm8ub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlZnRWYWx1ZSA9IChlbGVtZW50V2lkdGggKyB0aGlzLm9mZnNldExlZnQpIC0gcGFnZVdpZHRoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByaWdodFZhbHVlID0gKGVsZW1lbnRXaWR0aCArIChwYWdlV2lkdGggLSB0aGlzLm9mZnNldExlZnQpKSAtIHBhZ2VXaWR0aDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogUmVzZXQgcmlnaHQgYW5kIGxlZnQgdmFsdWUsIHVzZWZ1bCBvbiB3aW5kb3cgcmVzaXplICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUucmlnaHQgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFySW5mby5zdHlsZS5sZWZ0ID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50V2lkdGggPiBwYWdlV2lkdGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUubGVmdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxlZnRWYWx1ZSA+IDAgJiYgcmlnaHRWYWx1ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUucmlnaHQgPSAocmlnaHRWYWx1ZSAqIC0xKSArICdweCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsZWZ0VmFsdWUgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLmxlZnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLnJpZ2h0ID0gJzBweCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJIaWRlQnV0dG9uLScgKyBuZXdUb2tlbiksICdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHRoaXMucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgfHwgcC5wcmV2aW91c1NpYmxpbmcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZNaW5pVG9vbGJhci0nICsgbmV3VG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0UHJlZmVyZW5jZSgndG9vbGJhci9kaXNwbGF5U3RhdGUnLCAnbm9uZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWluaVRvZ2dsZXItJyArIG5ld1Rva2VuKSwgJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtID0gdGhpcy5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0uc3R5bGUuZGlzcGxheSA9PSAnbm9uZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIG5ld1Rva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyBuZXdUb2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIG5ld1Rva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyQ2xlYXJlci0nICsgbmV3VG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uc3R5bGUuZGlzcGxheSA9ICdub25lJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFByZWZlcmVuY2UoJ3Rvb2xiYXIvZGlzcGxheVN0YXRlJywgJ2Jsb2NrJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJBamF4UmVxdWVzdHMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1ibG9jay1hamF4JyksICdtb3VzZWVudGVyJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWJsb2NrLWFqYXggLnNmLXRvb2xiYXItaW5mbycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zY3JvbGxUb3AgPSBlbGVtLnNjcm9sbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stYWpheCA+IC5zZi10b29sYmFyLWljb24nKSwgJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHRoaXMucGFyZW50Tm9kZSwgJ2hvdmVyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGR1bXBJbmZvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stZHVtcCAuc2YtdG9vbGJhci1pbmZvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBkdW1wSW5mbykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkdW1wSW5mbywgJ3NmYmVmb3JlZHVtcGNvbGxhcHNlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1bXBJbmZvLnN0eWxlLm1pbkhlaWdodCA9IGR1bXBJbmZvLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCsncHgnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGR1bXBJbmZvLCAnbW91c2VsZWF2ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdW1wSW5mby5zdHlsZS5taW5IZWlnaHQgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZndkdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZndkdCcgKyB0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZndkdC5pbm5lckhUTUwgPSAnXFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2YtdG9vbGJhcnJlc2V0XCI+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNmLXRvb2xiYXItaWNvblwiPjxzdmcgd2lkdGg9XCIyNlwiIGhlaWdodD1cIjI4XCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZlcnNpb249XCIxLjFcIiB4PVwiMHB4XCIgeT1cIjBweFwiIHZpZXdCb3g9XCIwIDAgMjYgMjhcIiBlbmFibGUtYmFja2dyb3VuZD1cIm5ldyAwIDAgMjYgMjhcIiB4bWw6c3BhY2U9XCJwcmVzZXJ2ZVwiPjxwYXRoIGZpbGw9XCIjRkZGRkZGXCIgZD1cIk0xMyAwQzUuOCAwIDAgNS44IDAgMTNjMCA3LjIgNS44IDEzIDEzIDEzYzcuMiAwIDEzLTUuOCAxMy0xM0MyNiA1LjggMjAuMiAwIDEzIDB6IE0yMCA3LjUgYy0wLjYgMC0xLTAuMy0xLTAuOWMwLTAuMiAwLTAuNCAwLjItMC42YzAuMS0wLjMgMC4yLTAuMyAwLjItMC40YzAtMC4zLTAuNS0wLjQtMC43LTAuNGMtMiAwLjEtMi41IDIuNy0yLjkgNC44bC0wLjIgMS4xIGMxLjEgMC4yIDEuOSAwIDIuNC0wLjNjMC42LTAuNC0wLjItMC44LTAuMS0xLjNDMTggOS4yIDE4LjQgOSAxOC43IDguOWMwLjUgMCAwLjggMC41IDAuOCAxYzAgMC44LTEuMSAyLTMuMyAxLjkgYy0wLjMgMC0wLjUgMC0wLjctMC4xTDE1IDE0LjFjLTAuNCAxLjctMC45IDQuMS0yLjYgNi4yYy0xLjUgMS44LTMuMSAyLjEtMy44IDIuMWMtMS4zIDAtMi4xLTAuNi0yLjItMS42YzAtMC45IDAuOC0xLjQgMS4zLTEuNCBjMC43IDAgMS4yIDAuNSAxLjIgMS4xYzAgMC41LTAuMiAwLjYtMC40IDAuN2MtMC4xIDAuMS0wLjMgMC4yLTAuMyAwLjRjMCAwLjEgMC4xIDAuMyAwLjQgMC4zYzAuNSAwIDAuOS0wLjMgMS4yLTAuNSBjMS4zLTEgMS43LTIuOSAyLjQtNi4ybDAuMS0wLjhjMC4yLTEuMSAwLjUtMi4zIDAuOC0zLjVjLTAuOS0wLjctMS40LTEuNS0yLjYtMS44Yy0wLjgtMC4yLTEuMyAwLTEuNyAwLjRDOC40IDEwIDguNiAxMC43IDkgMTEuMSBsMC43IDAuN2MwLjggMC45IDEuMyAxLjcgMS4xIDIuN2MtMC4zIDEuNi0yLjEgMi44LTQuMyAyLjFjLTEuOS0wLjYtMi4yLTEuOS0yLTIuN2MwLjItMC42IDAuNy0wLjggMS4yLTAuNiBjMC41IDAuMiAwLjcgMC44IDAuNiAxLjNjMCAwLjEgMCAwLjEtMC4xIDAuM0M2IDE1IDUuOSAxNS4yIDUuOSAxNS4zYy0wLjEgMC40IDAuNCAwLjcgMC44IDAuOGMwLjggMC4zIDEuNy0wLjIgMS45LTAuOSBjMC4yLTAuNi0wLjItMS4xLTAuNC0xLjJsLTAuOC0wLjljLTAuNC0wLjQtMS4yLTEuNS0wLjgtMi44YzAuMi0wLjUgMC41LTEgMC45LTEuNGMxLTAuNyAyLTAuOCAzLTAuNmMxLjMgMC40IDEuOSAxLjIgMi44IDEuOSBjMC41LTEuMyAxLjEtMi42IDItMy44YzAuOS0xIDItMS43IDMuMy0xLjhDMjAgNC44IDIxIDUuNCAyMSA2LjNDMjEgNi43IDIwLjggNy41IDIwIDcuNXpcIi8+PC9zdmc+PC9kaXY+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgbG9hZGluZyB0aGUgd2ViIGRlYnVnIHRvb2xiYXIuIDxhIGhyZWY9XCJ7eyBwYXRoKFwiX3Byb2ZpbGVyX2hvbWVcIil8ZXNjYXBlKCdqcycpIH19JyArIG5ld1Rva2VuICsgJz5PcGVuIHRoZSB3ZWIgcHJvZmlsZXIuPC9hPlxcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZndkdC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3NmLXRvb2xiYXIgc2YtZXJyb3ItdG9vbGJhcicpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7IG1heFRyaWVzOiA1IH0KICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKHNlbGVjdG9yLCBlbE9uLCBlbE9mZikgewogICAgICAgICAgICAgICAgdmFyIHRtcCA9IGVsT24uc3R5bGUuZGlzcGxheSwKICAgICAgICAgICAgICAgICAgICBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGVjdG9yKTsKCiAgICAgICAgICAgICAgICBlbE9uLnN0eWxlLmRpc3BsYXkgPSBlbE9mZi5zdHlsZS5kaXNwbGF5OwogICAgICAgICAgICAgICAgZWxPZmYuc3R5bGUuZGlzcGxheSA9IHRtcDsKCiAgICAgICAgICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnID09PSB0bXAgPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3JlYXRlVGFiczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdGFiR3JvdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNmLXRhYnM6bm90KFtkYXRhLXByb2Nlc3NlZD10cnVlXSknKTsKCiAgICAgICAgICAgICAgICAvKiBjcmVhdGUgdGhlIHRhYiBuYXZpZ2F0aW9uIGZvciBlYWNoIGdyb3VwIG9mIHRhYnMgKi8KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFiR3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRhYnMgPSB0YWJHcm91cHNbaV0ucXVlcnlTZWxlY3RvckFsbCgnOnNjb3BlID4gLnRhYicpOwogICAgICAgICAgICAgICAgICAgIHZhciB0YWJOYXZpZ2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTsKICAgICAgICAgICAgICAgICAgICB0YWJOYXZpZ2F0aW9uLmNsYXNzTmFtZSA9ICd0YWItbmF2aWdhdGlvbic7CgogICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFRhYklkID0gJ3RhYi0nICsgaSArICctMCc7IC8qIHNlbGVjdCB0aGUgZmlyc3QgdGFiIGJ5IGRlZmF1bHQgKi8KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYklkID0gJ3RhYi0nICsgaSArICctJyArIGo7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJUaXRsZSA9IHRhYnNbal0ucXVlcnlTZWxlY3RvcignLnRhYi10aXRsZScpLmlubmVySFRNTDsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJOYXZpZ2F0aW9uSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb25JdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS10YWItaWQnLCB0YWJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNDbGFzcyh0YWJzW2pdLCAnYWN0aXZlJykpIHsgc2VsZWN0ZWRUYWJJZCA9IHRhYklkOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNDbGFzcyh0YWJzW2pdLCAnZGlzYWJsZWQnKSkgeyBhZGRDbGFzcyh0YWJOYXZpZ2F0aW9uSXRlbSwgJ2Rpc2FibGVkJyk7IH0KICAgICAgICAgICAgICAgICAgICAgICAgdGFiTmF2aWdhdGlvbkl0ZW0uaW5uZXJIVE1MID0gdGFiVGl0bGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb24uYXBwZW5kQ2hpbGQodGFiTmF2aWdhdGlvbkl0ZW0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYkNvbnRlbnQgPSB0YWJzW2pdLnF1ZXJ5U2VsZWN0b3IoJy50YWItY29udGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICB0YWJDb250ZW50LnBhcmVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIHRhYklkKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRhYkdyb3Vwc1tpXS5pbnNlcnRCZWZvcmUodGFiTmF2aWdhdGlvbiwgdGFiR3JvdXBzW2ldLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXRhYi1pZD1cIicgKyBzZWxlY3RlZFRhYklkICsgJ1wiXScpLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLyogZGlzcGxheSB0aGUgYWN0aXZlIHRhYiBhbmQgYWRkIHRoZSAnY2xpY2snIGV2ZW50IGxpc3RlbmVycyAqLwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRhYkdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb24gPSB0YWJHcm91cHNbaV0ucXVlcnlTZWxlY3RvckFsbCgnOnNjb3BlID4gLnRhYi1uYXZpZ2F0aW9uIGxpJyk7CgogICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB0YWJOYXZpZ2F0aW9uLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYklkID0gdGFiTmF2aWdhdGlvbltqXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFiLWlkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5xdWVyeVNlbGVjdG9yKCcudGFiLXRpdGxlJykuY2xhc3NOYW1lID0gJ2hpZGRlbic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ2xhc3ModGFiTmF2aWdhdGlvbltqXSwgJ2FjdGl2ZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJJZCkuY2xhc3NOYW1lID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5jbGFzc05hbWUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFiTmF2aWdhdGlvbltqXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3RpdmVUYWIgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbmVlZGVkIGJlY2F1c2Ugd2hlbiB0aGUgdGFiIGNvbnRhaW5zIEhUTUwgY29udGVudHMsIHVzZXIgY2FuIGNsaWNrICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBvbiBhbnkgb2YgdGhvc2UgZWxlbWVudHMgaW5zdGVhZCBvZiB0aGVpciBwYXJlbnQgJzxsaT4nIGVsZW1lbnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChhY3RpdmVUYWIudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnbGknKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlVGFiID0gYWN0aXZlVGFiLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZ2V0IHRoZSBmdWxsIGxpc3Qgb2YgdGFicyB0aHJvdWdoIHRoZSBwYXJlbnQgb2YgdGhlIGFjdGl2ZSB0YWIgZWxlbWVudCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYk5hdmlnYXRpb24gPSBhY3RpdmVUYWIucGFyZW50Tm9kZS5jaGlsZHJlbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGFiTmF2aWdhdGlvbi5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJJZCA9IHRhYk5hdmlnYXRpb25ba10uZ2V0QXR0cmlidXRlKCdkYXRhLXRhYi1pZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5jbGFzc05hbWUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyh0YWJOYXZpZ2F0aW9uW2tdLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3MoYWN0aXZlVGFiLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlVGFiSWQgPSBhY3RpdmVUYWIuZ2V0QXR0cmlidXRlKCdkYXRhLXRhYi1pZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYWN0aXZlVGFiSWQpLmNsYXNzTmFtZSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGFiR3JvdXBzW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9jZXNzZWQnLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3JlYXRlVG9nZ2xlczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdG9nZ2xlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b2dnbGU6bm90KFtkYXRhLXByb2Nlc3NlZD10cnVlXSknKTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvZ2dsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudFNlbGVjdG9yID0gdG9nZ2xlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLXNlbGVjdG9yJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnRTZWxlY3Rvcik7CgogICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtY29udGVudCcpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodG9nZ2xlc1tpXS5oYXNBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLWluaXRpYWwnKSAmJiB0b2dnbGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS10b2dnbGUtaW5pdGlhbCcpID09ICdkaXNwbGF5JykgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyh0b2dnbGVzW2ldLCAnc2YtdG9nZ2xlLW9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtdmlzaWJsZScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKHRvZ2dsZXNbaV0sICdzZi10b2dnbGUtb2ZmJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKHRvZ2dsZXNbaV0sICdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCcnICE9PSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogRG9uJ3QgZG8gYW55dGhpbmcgb24gdGV4dCBzZWxlY3Rpb24gKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvZ2dsZSA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIG5lZWRlZCBiZWNhdXNlIHdoZW4gdGhlIHRvZ2dsZSBjb250YWlucyBIVE1MIGNvbnRlbnRzLCB1c2VyIGNhbiBjbGljayAqLwogICAgICAgICAgICAgICAgICAgICAgICAvKiBvbiBhbnkgb2YgdGhvc2UgZWxlbWVudHMgaW5zdGVhZCBvZiB0aGVpciBwYXJlbnQgJy5zZi10b2dnbGUnIGVsZW1lbnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCFoYXNDbGFzcyh0b2dnbGUsICdzZi10b2dnbGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlID0gdG9nZ2xlLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0b2dnbGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1zZWxlY3RvcicpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHRvZ2dsZSwgJ3NmLXRvZ2dsZS1vbicpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyh0b2dnbGUsICdzZi10b2dnbGUtb2ZmJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtdmlzaWJsZScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLyogdGhlIHRvZ2dsZSBkb2Vzbid0IGNoYW5nZSBpdHMgY29udGVudHMgd2hlbiBjbGlja2luZyBvbiBpdCAqLwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRvZ2dsZS5oYXNBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLWFsdC1jb250ZW50JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0b2dnbGUuaGFzQXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1vcmlnaW5hbC1jb250ZW50JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLW9yaWdpbmFsLWNvbnRlbnQnLCB0b2dnbGUuaW5uZXJIVE1MKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRDb250ZW50ID0gdG9nZ2xlLmlubmVySFRNTDsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWdpbmFsQ29udGVudCA9IHRvZ2dsZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLW9yaWdpbmFsLWNvbnRlbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsdENvbnRlbnQgPSB0b2dnbGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1hbHQtY29udGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGUuaW5uZXJIVE1MID0gY3VycmVudENvbnRlbnQgIT09IGFsdENvbnRlbnQgPyBhbHRDb250ZW50IDogb3JpZ2luYWxDb250ZW50OwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvKiBQcmV2ZW50cyBmcm9tIGRpc2FsbG93aW5nIGNsaWNrcyBvbiBsaW5rcyBpbnNpZGUgdG9nZ2xlcyAqLwogICAgICAgICAgICAgICAgICAgIHZhciB0b2dnbGVMaW5rcyA9IHRvZ2dsZXNbaV0ucXVlcnlTZWxlY3RvckFsbCgnYScpOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdG9nZ2xlTGlua3MubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcih0b2dnbGVMaW5rc1tqXSwgJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0b2dnbGVzW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9jZXNzZWQnLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3JlYXRlRmlsdGVyczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1maWx0ZXJzXSBbZGF0YS1maWx0ZXJdJykuZm9yRWFjaChmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbHRlcnMgPSBmaWx0ZXIuY2xvc2VzdCgnW2RhdGEtZmlsdGVyc10nKSwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICdjaG9pY2UnLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gZmlsdGVyLmRhdGFzZXQuZmlsdGVyLAogICAgICAgICAgICAgICAgICAgICAgICB1Y05hbWUgPSBuYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpK25hbWUuc2xpY2UoMSksCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBmaWx0ZXJzLmRhdGFzZXRbJ2ZpbHRlcicrdWNOYW1lXSB8fCBmaWx0ZXJzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWZpbHRlci0nK25hbWUrJ10nKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRzID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhlZCA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWQgPSB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlcyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICdsZXZlbCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVscyA9IHZhbHVlcy5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB2YWx1ZXMudG9Mb3dlckNhc2UoKS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0cyA9IHZhbHVlcy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhsaXN0LCAnZmlsdGVyLWxpc3QnKTsKICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhsaXN0LCAnZmlsdGVyLWxpc3QtJyt0eXBlKTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuZGF0YXNldFsnZmlsdGVyJyt1Y05hbWVdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSBpbiBwcm9jZXNzZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gaSBpbiBsYWJlbHMgPyBsYWJlbHNbaV0gOiB2YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlczsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCcnID09PSBsYWJlbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLmlubmVySFRNTCA9ICc8ZW0+KG5vbmUpPC9lbT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLmlubmVyVGV4dCA9IGxhYmVsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbi5kYXRhc2V0LmZpbHRlciA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24uc2V0QXR0cmlidXRlKCd0aXRsZScsIDEgPT09IChtYXRjaGVzID0gZmlsdGVycy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1maWx0ZXItJytuYW1lKyc9XCInK3ZhbHVlKydcIl0nKS5sZW5ndGgpID8gJ01hdGNoZXMgMSByb3cnIDogJ01hdGNoZXMgJyttYXRjaGVzKycgcm93cycpOwogICAgICAgICAgICAgICAgICAgICAgICBpbmRleGVkW3ZhbHVlXSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQob3B0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihvcHRpb24sICdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgnY2hvaWNlJyA9PT0gdHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnMucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZmlsdGVyLScrbmFtZSsnXScpLmZvckVhY2goZnVuY3Rpb24gKHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uLmRhdGFzZXQuZmlsdGVyID09PSByb3cuZGF0YXNldFsnZmlsdGVyJyt1Y05hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhyb3csICdmaWx0ZXItaGlkZGVuLScrbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhvcHRpb24sICdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJ2xldmVsJyA9PT0gdHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSB0aGlzLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvckFsbCgnLmFjdGl2ZScpLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvckFsbCgnbGknKS5mb3JFYWNoKGZ1bmN0aW9uIChjdXJyZW50T3B0aW9uLCBqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqIDw9IGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGN1cnJlbnRPcHRpb24sICdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSBqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3MoY3VycmVudE9wdGlvbiwgJ2xhc3QtYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGN1cnJlbnRPcHRpb24sICdsYXN0LWFjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoY3VycmVudE9wdGlvbiwgJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoY3VycmVudE9wdGlvbiwgJ2xhc3QtYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWZpbHRlci0nK25hbWUrJ10nKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCBpbmRleGVkW3Jvdy5kYXRhc2V0WydmaWx0ZXInK3VjTmFtZV1dKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhyb3csICdmaWx0ZXItaGlkZGVuLScrbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhyb3csICdmaWx0ZXItaGlkZGVuLScrbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgnY2hvaWNlJyA9PT0gdHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlID0gbnVsbCA9PT0gZGVmYXVsdHMgfHwgMCA8PSBkZWZhdWx0cy5pbmRleE9mKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgnbGV2ZWwnID09PSB0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmUgPSBpIDw9IGRlZmF1bHRzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZSAmJiBpID09PSBkZWZhdWx0cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKG9wdGlvbiwgJ2xhc3QtYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3Mob3B0aW9uLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWZpbHRlci0nK25hbWUrJz1cIicrdmFsdWUrJ1wiXScpLmZvckVhY2goZnVuY3Rpb24gKHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHJvdywgJ2ZpbHRlci1oaWRkZW4tJytuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZFt2YWx1ZV0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoMSA8IGxpc3QuY2hpbGROb2Rlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLmFwcGVuZENoaWxkKGxpc3QpOwogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuZGF0YXNldC5maWx0ZXJlZCA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0pKCk7CgogICAgU2Zqcy5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LCAnRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIFNmanMuY3JlYXRlVGFicygpOwogICAgICAgIFNmanMuY3JlYXRlVG9nZ2xlcygpOwogICAgfSk7CgovKl1dPiovPC9zY3JpcHQ+CiIsICJAV2ViUHJvZmlsZXIvUHJvZmlsZXIvYmFzZV9qcy5odG1sLnR3aWciLCAiL2hvbWUvd3d3cm9vdC9zZjQvdmVuZG9yL3N5bWZvbnkvd2ViLXByb2ZpbGVyLWJ1bmRsZS9SZXNvdXJjZXMvdmlld3MvUHJvZmlsZXIvYmFzZV9qcy5odG1sLnR3aWciKTsKICAgIH0KfQoiO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAbmFtZXNwYWNlcyI7YTowOnt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBpbmNsdWRlcyI7YTowOnt9czo0NDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBmdW5jdGlvbnMiO2E6MDp7fXM6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAY29uc3RhbnRzIjthOjA6e31zOjQyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGNsYXNzZXMiO2E6MTp7czo4MDoiXF9fVHdpZ1RlbXBsYXRlXzI5YTBhNjI1NzJmMGMyZWU0ZDQzM2VkMmFjODY4ODRiMGI3ZTg3MzUyYTkzNmU4MmU4OTg5ZDc4NDc3MzdjNDUiO086MzU6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfIjoxMTp7czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGZxc2VuIjtPOjMwOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4iOjI6e3M6Mzc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AZnFzZW4iO3M6ODA6IlxfX1R3aWdUZW1wbGF0ZV8yOWEwYTYyNTcyZjBjMmVlNGQ0MzNlZDJhYzg2ODg0YjBiN2U4NzM1MmE5MzZlODJlODk4OWQ3ODQ3NzM3YzQ1IjtzOjM2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAG5hbWUiO3M6Nzk6Il9fVHdpZ1RlbXBsYXRlXzI5YTBhNjI1NzJmMGMyZWU0ZDQzM2VkMmFjODY4ODRiMGI3ZTg3MzUyYTkzNmU4MmU4OTg5ZDc4NDc3MzdjNDUiO31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AZG9jQmxvY2siO047czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGFic3RyYWN0IjtiOjA7czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGZpbmFsIjtiOjA7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAHBhcmVudCI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjE0OiJcVHdpZ1xUZW1wbGF0ZSI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjg6IlRlbXBsYXRlIjt9czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGltcGxlbWVudHMiO2E6MDp7fXM6NDY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBjb25zdGFudHMiO2E6MDp7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBwcm9wZXJ0aWVzIjthOjI6e3M6ODk6IlxfX1R3aWdUZW1wbGF0ZV8yOWEwYTYyNTcyZjBjMmVlNGQ0MzNlZDJhYzg2ODg0YjBiN2U4NzM1MmE5MzZlODJlODk4OWQ3ODQ3NzM3YzQ1Ojokc291cmNlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5Ijo4OntzOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjg5OiJcX19Ud2lnVGVtcGxhdGVfMjlhMGE2MjU3MmYwYzJlZTRkNDMzZWQyYWM4Njg4NGIwYjdlODczNTJhOTM2ZTgyZTg5ODlkNzg0NzczN2M0NTo6JHNvdXJjZSI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjY6InNvdXJjZSI7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AGRvY0Jsb2NrIjtOO3M6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AHR5cGVzIjthOjA6e31zOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBkZWZhdWx0IjtOO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AHN0YXRpYyI7YjowO3M6NDk6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AHZpc2liaWxpdHkiO086Mzk6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcVmlzaWJpbGl0eSI6MTp7czo1MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcVmlzaWJpbGl0eQB2aXNpYmlsaXR5IjtzOjc6InByaXZhdGUiO31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBsb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6MTg7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAdHlwZSI7Tjt9czo4OToiXF9fVHdpZ1RlbXBsYXRlXzI5YTBhNjI1NzJmMGMyZWU0ZDQzM2VkMmFjODY4ODRiMGI3ZTg3MzUyYTkzNmU4MmU4OTg5ZDc4NDc3MzdjNDU6OiRtYWNyb3MiO086Mzc6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkiOjg6e3M6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AGZxc2VuIjtPOjMwOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4iOjI6e3M6Mzc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AZnFzZW4iO3M6ODk6IlxfX1R3aWdUZW1wbGF0ZV8yOWEwYTYyNTcyZjBjMmVlNGQ0MzNlZDJhYzg2ODg0YjBiN2U4NzM1MmE5MzZlODJlODk4OWQ3ODQ3NzM3YzQ1OjokbWFjcm9zIjtzOjM2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAG5hbWUiO3M6NjoibWFjcm9zIjt9czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAZG9jQmxvY2siO047czo0NDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAdHlwZXMiO2E6MDp7fXM6NDY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AGRlZmF1bHQiO3M6MjoiW10iO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AHN0YXRpYyI7YjowO3M6NDk6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AHZpc2liaWxpdHkiO086Mzk6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcVmlzaWJpbGl0eSI6MTp7czo1MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcVmlzaWJpbGl0eQB2aXNpYmlsaXR5IjtzOjc6InByaXZhdGUiO31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBsb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6MTk7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAdHlwZSI7Tjt9fXM6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBtZXRob2RzIjthOjY6e3M6OTU6IlxfX1R3aWdUZW1wbGF0ZV8yOWEwYTYyNTcyZjBjMmVlNGQ0MzNlZDJhYzg2ODg0YjBiN2U4NzM1MmE5MzZlODJlODk4OWQ3ODQ3NzM3YzQ1OjpfX2NvbnN0cnVjdCgpIjtPOjM1OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZCI6OTp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGRvY0Jsb2NrIjtOO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjk1OiJcX19Ud2lnVGVtcGxhdGVfMjlhMGE2MjU3MmYwYzJlZTRkNDMzZWQyYWM4Njg4NGIwYjdlODczNTJhOTM2ZTgyZTg5ODlkNzg0NzczN2M0NTo6X19jb25zdHJ1Y3QoKSI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjExOiJfX2NvbnN0cnVjdCI7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABhYnN0cmFjdCI7YjowO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmaW5hbCI7YjowO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABzdGF0aWMiO2I6MDtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAdmlzaWJpbGl0eSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5IjoxOntzOjUxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5AHZpc2liaWxpdHkiO3M6NjoicHVibGljIjt9czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFyZ3VtZW50cyI7YToxOntpOjA7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudCI6NTp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAbmFtZSI7czozOiJlbnYiO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AHR5cGUiO086Mzg6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xPYmplY3RfIjoxOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXE9iamVjdF8AZnFzZW4iO086MzA6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbiI6Mjp7czozNzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBmcXNlbiI7czoxNzoiXFR3aWdcRW52aXJvbm1lbnQiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czoxMToiRW52aXJvbm1lbnQiO319czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAZGVmYXVsdCI7TjtzOjUwOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudABieVJlZmVyZW5jZSI7YjowO3M6NDk6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AGlzVmFyaWFkaWMiO2I6MDt9fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABsb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6MjE7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHJldHVyblR5cGUiO086Mzc6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xNaXhlZF8iOjA6e319czo5MzoiXF9fVHdpZ1RlbXBsYXRlXzI5YTBhNjI1NzJmMGMyZWU0ZDQzM2VkMmFjODY4ODRiMGI3ZTg3MzUyYTkzNmU4MmU4OTg5ZDc4NDc3MzdjNDU6OmRvRGlzcGxheSgpIjtPOjM1OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZCI6OTp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGRvY0Jsb2NrIjtOO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjkzOiJcX19Ud2lnVGVtcGxhdGVfMjlhMGE2MjU3MmYwYzJlZTRkNDMzZWQyYWM4Njg4NGIwYjdlODczNTJhOTM2ZTgyZTg5ODlkNzg0NzczN2M0NTo6ZG9EaXNwbGF5KCkiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czo5OiJkb0Rpc3BsYXkiO31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAYWJzdHJhY3QiO2I6MDtzOjQyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZmluYWwiO2I6MDtzOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAc3RhdGljIjtiOjA7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHZpc2liaWxpdHkiO086Mzk6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcVmlzaWJpbGl0eSI6MTp7czo1MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcVmlzaWJpbGl0eQB2aXNpYmlsaXR5IjtzOjk6InByb3RlY3RlZCI7fXM6NDY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABhcmd1bWVudHMiO2E6Mjp7aTowO086Mzc6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQiOjU6e3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AG5hbWUiO3M6NzoiY29udGV4dCI7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAdHlwZSI7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXEFycmF5XyI6Mzp7czoxMjoiACoAdmFsdWVUeXBlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcTWl4ZWRfIjowOnt9czoxMDoiACoAa2V5VHlwZSI7TjtzOjE3OiIAKgBkZWZhdWx0S2V5VHlwZSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXENvbXBvdW5kIjoxOntzOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXENvbXBvdW5kAHR5cGVzIjthOjI6e2k6MDtPOjM4OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcU3RyaW5nXyI6MDp7fWk6MTtPOjM4OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcSW50ZWdlciI6MDp7fX19fXM6NDY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AGRlZmF1bHQiO047czo1MDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAYnlSZWZlcmVuY2UiO2I6MDtzOjQ5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudABpc1ZhcmlhZGljIjtiOjA7fWk6MTtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50Ijo1OntzOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudABuYW1lIjtzOjY6ImJsb2NrcyI7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAdHlwZSI7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXEFycmF5XyI6Mzp7czoxMjoiACoAdmFsdWVUeXBlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcTWl4ZWRfIjowOnt9czoxMDoiACoAa2V5VHlwZSI7TjtzOjE3OiIAKgBkZWZhdWx0S2V5VHlwZSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXENvbXBvdW5kIjoxOntzOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXENvbXBvdW5kAHR5cGVzIjthOjI6e2k6MDtPOjM4OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcU3RyaW5nXyI6MDp7fWk6MTtPOjM4OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcSW50ZWdlciI6MDp7fX19fXM6NDY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AGRlZmF1bHQiO3M6MjoiW10iO3M6NTA6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AGJ5UmVmZXJlbmNlIjtiOjA7czo0OToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAaXNWYXJpYWRpYyI7YjowO319czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGxvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aTozMztzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGNvbHVtbk51bWJlciI7aTowO31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAcmV0dXJuVHlwZSI7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXE1peGVkXyI6MDp7fX1zOjk5OiJcX19Ud2lnVGVtcGxhdGVfMjlhMGE2MjU3MmYwYzJlZTRkNDMzZWQyYWM4Njg4NGIwYjdlODczNTJhOTM2ZTgyZTg5ODlkNzg0NzczN2M0NTo6Z2V0VGVtcGxhdGVOYW1lKCkiO086MzU6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kIjo5OntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZG9jQmxvY2siO047czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZxc2VuIjtPOjMwOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4iOjI6e3M6Mzc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AZnFzZW4iO3M6OTk6IlxfX1R3aWdUZW1wbGF0ZV8yOWEwYTYyNTcyZjBjMmVlNGQ0MzNlZDJhYzg2ODg0YjBiN2U4NzM1MmE5MzZlODJlODk4OWQ3ODQ3NzM3YzQ1OjpnZXRUZW1wbGF0ZU5hbWUoKSI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjE1OiJnZXRUZW1wbGF0ZU5hbWUiO31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAYWJzdHJhY3QiO2I6MDtzOjQyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZmluYWwiO2I6MDtzOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAc3RhdGljIjtiOjA7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHZpc2liaWxpdHkiO086Mzk6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcVmlzaWJpbGl0eSI6MTp7czo1MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcVmlzaWJpbGl0eQB2aXNpYmlsaXR5IjtzOjY6InB1YmxpYyI7fXM6NDY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABhcmd1bWVudHMiO2E6MDp7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABsb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6ODg4O3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAByZXR1cm5UeXBlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcTWl4ZWRfIjowOnt9fXM6OTU6IlxfX1R3aWdUZW1wbGF0ZV8yOWEwYTYyNTcyZjBjMmVlNGQ0MzNlZDJhYzg2ODg0YjBiN2U4NzM1MmE5MzZlODJlODk4OWQ3ODQ3NzM3YzQ1Ojppc1RyYWl0YWJsZSgpIjtPOjM1OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZCI6OTp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGRvY0Jsb2NrIjtOO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjk1OiJcX19Ud2lnVGVtcGxhdGVfMjlhMGE2MjU3MmYwYzJlZTRkNDMzZWQyYWM4Njg4NGIwYjdlODczNTJhOTM2ZTgyZTg5ODlkNzg0NzczN2M0NTo6aXNUcmFpdGFibGUoKSI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjExOiJpc1RyYWl0YWJsZSI7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABhYnN0cmFjdCI7YjowO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmaW5hbCI7YjowO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABzdGF0aWMiO2I6MDtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAdmlzaWJpbGl0eSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5IjoxOntzOjUxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5AHZpc2liaWxpdHkiO3M6NjoicHVibGljIjt9czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFyZ3VtZW50cyI7YTowOnt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGxvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aTo4OTM7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHJldHVyblR5cGUiO086Mzc6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xNaXhlZF8iOjA6e319czo5NjoiXF9fVHdpZ1RlbXBsYXRlXzI5YTBhNjI1NzJmMGMyZWU0ZDQzM2VkMmFjODY4ODRiMGI3ZTg3MzUyYTkzNmU4MmU4OTg5ZDc4NDc3MzdjNDU6OmdldERlYnVnSW5mbygpIjtPOjM1OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZCI6OTp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGRvY0Jsb2NrIjtOO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjk2OiJcX19Ud2lnVGVtcGxhdGVfMjlhMGE2MjU3MmYwYzJlZTRkNDMzZWQyYWM4Njg4NGIwYjdlODczNTJhOTM2ZTgyZTg5ODlkNzg0NzczN2M0NTo6Z2V0RGVidWdJbmZvKCkiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czoxMjoiZ2V0RGVidWdJbmZvIjt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFic3RyYWN0IjtiOjA7czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZpbmFsIjtiOjA7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHN0YXRpYyI7YjowO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAB2aXNpYmlsaXR5IjtPOjM5OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkiOjE6e3M6NTE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkAdmlzaWJpbGl0eSI7czo2OiJwdWJsaWMiO31zOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAYXJndW1lbnRzIjthOjA6e31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAbG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjg5ODtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGNvbHVtbk51bWJlciI7aTowO31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAcmV0dXJuVHlwZSI7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXE1peGVkXyI6MDp7fX1zOjEwMDoiXF9fVHdpZ1RlbXBsYXRlXzI5YTBhNjI1NzJmMGMyZWU0ZDQzM2VkMmFjODY4ODRiMGI3ZTg3MzUyYTkzNmU4MmU4OTg5ZDc4NDc3MzdjNDU6OmdldFNvdXJjZUNvbnRleHQoKSI7TzozNToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QiOjk6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABkb2NCbG9jayI7TjtzOjQyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZnFzZW4iO086MzA6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbiI6Mjp7czozNzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBmcXNlbiI7czoxMDA6IlxfX1R3aWdUZW1wbGF0ZV8yOWEwYTYyNTcyZjBjMmVlNGQ0MzNlZDJhYzg2ODg0YjBiN2U4NzM1MmE5MzZlODJlODk4OWQ3ODQ3NzM3YzQ1OjpnZXRTb3VyY2VDb250ZXh0KCkiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czoxNjoiZ2V0U291cmNlQ29udGV4dCI7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABhYnN0cmFjdCI7YjowO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmaW5hbCI7YjowO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABzdGF0aWMiO2I6MDtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAdmlzaWJpbGl0eSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5IjoxOntzOjUxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5AHZpc2liaWxpdHkiO3M6NjoicHVibGljIjt9czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFyZ3VtZW50cyI7YTowOnt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGxvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aTo5MDM7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHJldHVyblR5cGUiO086Mzc6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xNaXhlZF8iOjA6e319fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwB1c2VkVHJhaXRzIjthOjA6e31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AbG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjE2O3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fX19czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBpbnRlcmZhY2VzIjthOjA6e31zOjQxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHRyYWl0cyI7YTowOnt9fQ==";